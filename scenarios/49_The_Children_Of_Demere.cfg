#textdomain wesnoth-Aria_of_the_Dragon_Slayer

[scenario]
    id=49_The_Children_Of_Demere
    name= _ "The Children of Demere"
    next_scenario=50_The_Dragon_And_The_Slayer
    map_data="{~add-ons/Aria_of_the_Dragon_Slayer/maps/49_The_Children_Of_Demere.map}"
    turns=-1
    {FALLEN_THIRD_SUN}

    # Epic tracks only...
    {SCENARIO_MUSIC battlecry.ogg}
    {EXTRA_SCENARIO_MUSIC battle-epic.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC March_of_the_divine.ogg}
    {EXTRA_SCENARIO_MUSIC In_the_Land_of_Madness.ogg}

    {WEAPON_SPECIALS_EVENTS}
    {CONTROL_KINGS_ARMIES}
    {CONTROL_KINGS_OF_IRDYA}

    [event]
        name=prestart

        [objectives]
            side=0
            [objective]
                description= _ "Destroy the Dragons of Death"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of any of the Kings and Queens"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Valerya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kenshiro"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Aeldhoryan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Natsu"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dragana"
                condition=lose
            [/objective]

            note=_"NOTE: Only the heroes and heroines mentioned in the Objectives must be kept alive.

Also, in this scenario, you have the choice to control the Kings and the Queens, and/or their armies, by right-clicking anywhere on the screen. When controlling the armies, you will play as their sides in addition to your original side."
        [/objectives]
    [/event]

    {CHILDREN_OF_DEMERE_STORY}
    {STARTING_VILLAGES 1 7}
    {STARTING_VILLAGES 2 12}

    [side]
        {TENMA}
        recruit=
        {GOLD 1000 950 900}
        {INCOME 30 20 20}
        team_name=teamtenma
        user_team_name=_"Human Legion"

        {FLAG_VARIANT6 ragged}
    [/side]

    [side]
        {AGADHOR}
        recruit=Skeletal Dragon,Spectre,Nightgaunt,Saurian Lich
        side=2
        team_name=dragons
        user_team_name=_"Fallen Dragon Army"
        {GOLD 3000 3500 4000}
        {INCOME 50 65 80}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,mixed fighter,scout,scout
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT undead}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Skeletal Dragon) 6}

    [side]
        no_leader=yes
        recruit=Faun Soldier,Anuran Rider,Faerie Sprite,Fire Faerie,Elvish Champion,Elvish Enchantress,Elvish Sharpshooter,Elvish Shyde,Ancient Wose,Elvish Hero,Elvish Marksman,Elvish Sorceress,Elvish Druid,Elder Wose
        side=3
        controller=human
        team_name=teamtenma
        user_team_name=_"Sylvan Host"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,mixed fighter,archer,healer,scout
        [/ai]
        {FLAG_VARIANT wood-elvish}
    [/side]

    [side]
        no_leader=yes
        recruit=Inferno Drake,Drake Blademaster,Drake Enforcer,Hurricane Drake,Fire Drake,Drake Warrior,Drake Clasher,Sky Drake,Saurian Ambusher,Saurian Flanker
        side=4
        controller=human
        team_name=teamtenma
        user_team_name=_"Children of Morogor"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,archer,archer,archer,scout
        [/ai]
        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        no_leader=yes
        recruit=Dwarvish Lord,Dwarvish Runemaster,Dwarvish Dragonguard,Dwarvish Sentinel,Dwarvish Explorer,Dwarvish Steelclad,Dwarvish Runesmith,Dwarvish Thunderguard,Dwarvish Stalwart,Dwarvish Pathfinder
        side=5
        controller=human
        team_name=teamtenma
        user_team_name=_"Offspring of the Earth"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter,scout
        [/ai]
        {FLAG_VARIANT knalgan}
    [/side]

    [side]
        no_leader=yes
        recruit=Great Troll,Troll Warrior,Troll Boulderlobber,Troll,Troll Shaman,Troll Rocklobber
        side=6
        controller=human
        team_name=teamtenma
        user_team_name=_"Offspring of the Abyss"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter,mixed fighter
        [/ai]
        {FLAG_VARIANT6 ragged}
    [/side]

    [side]
        no_leader=yes
        recruit=Merman Triton,Merman Hoplite,Merman Entangler,Merman Javelineer,Mermaid Siren,Mermaid Diviner,Merman Warrior,Merman Thunder Warrior,Merman Netcaster,Merman Spearman,Mermaid Enchantress,Mermaid Priestess,Naga Warrior,Naga Myrmidon,Cuttle Fish,Sea Serpent,Water Serpent
        side=7
        controller=human
        team_name=teamtenma
        user_team_name=_"Folk of the Oceans"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,mixed fighter,mixed fighter,healer
        [/ai]
        {FLAG_VARIANT wood-elvish}
    [/side]

    [side]
        no_leader=yes
        recruit=Orcish Warlord,Orcish Slurbow,Orcish Sorcerer,Direwolf Rider,Orcish Warrior,Orcish Crossbowman,Orcish Warlock,Goblin Knight,Goblin Pillager
        side=8
        controller=human
        team_name=teamtenma
        user_team_name=_"The Great Horde"
        {GOLD 600 550 500}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,archer,archer,mixed fighter,scout
        [/ai]
        {FLAG_VARIANT6 ragged}
    [/side]

    [side]
        no_leader=yes
        recruit=Soulless,Ghost
        side=9
        team_name=dragons
        user_team_name=_"Fallen Dragon Army"
        {GOLD 500 450 400}
        {INCOME 40 30 20}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,archer,archer,mixed fighter,scout
        [/ai]
        {FLAG_VARIANT6 ragged}
    [/side]

    {RECRUIT_UNIT_VARIATIONS 9 "Soulless" drake}

    [event]
        name=prestart

        [recall]
            id=Olokun
            x,y=28,58
        [/recall]

        [recall]
            id=Derceto
            x,y=8,56
        [/recall]

        [recall]
            id=Cornelya
            x,y=50,4
        [/recall]

        [recall]
            id=Algil
            x,y=53,59
        [/recall]

        [recall]
            id=Udhark
            x,y=55,32
        [/recall]

        [recall]
            id=Bogor
            x,y=3,32
        [/recall]

        [recall]
            id=Veshtar
            x,y=8,4
        [/recall]

        [recall]
            id=Kenshiro
            x,y=49,4
        [/recall]

        [recall]
            id=Valerya
            x,y=28,57
        [/recall]

        [recall]
            id=Aeldhoryan
            x,y=29,58
        [/recall]

        [recall]
            id=Natsu
            x,y=30,57
        [/recall]

        [recall]
            id=Ankhmare
            x,y=27,58
        [/recall]

        [recall]
            id=Dragana
            x,y=29,59
        [/recall]

        [recall]
            id=Yiwen
            x,y=28,59
        [/recall]

        [recall]
            id=Gelendras
            x,y=50,5
        [/recall]

        [recall]
            id=Idunn
            x,y=51,6
        [/recall]

        [recall]
            id=Umbrius
            x,y=51,5
        [/recall]

        [recall]
            id=Donar
            x,y=53,58
        [/recall]

        [recall]
            id=Tallin
            x,y=27,59
        [/recall]

        [recall]
            id=Thrur
            x,y=54,31
        [/recall]

        [recall]
            id=Shwarzel
            x,y=50,3
        [/recall]

        [recall]
            id=Augdras
            x,y=52,58
        [/recall]

        [recall]
            id=Ikki
            x,y=31,58
        [/recall]

        [recall]
            id=Leukothea
            x,y=7,56
        [/recall]

        {MODIFY_UNIT id=Kenshiro side 3}
        {MODIFY_UNIT id=Cornelya side 3}
        {MODIFY_UNIT id=Gelendras side 3}
        {MODIFY_UNIT id=Umbrius side 3}
        {MODIFY_UNIT id=Idunn side 3}
        {MODIFY_UNIT id=Shwarzel side 3}

        {MODIFY_UNIT id=Veshtar side 4}

        {MODIFY_UNIT id=Algil side 5}
        {MODIFY_UNIT id=Donar side 5}
        {MODIFY_UNIT id=Augdras side 5}

        {MODIFY_UNIT id=Udhark side 6}
        {MODIFY_UNIT id=Thrur side 6}

        {MODIFY_UNIT id=Derceto side 7}

        {MODIFY_UNIT id=Bogor side 8}

        [store_unit]
            kill=yes
            variable=true_elementals_final
            [filter]
                side=1
                type=Air Spirit,Fire Spirit,Water Spirit, Earth Spirit, Air Embodiment,Fire Embodiment,Water Embodiment,Earth Embodiment,Gali,Niti,Agni,Bhumi
            [/filter]
        [/store_unit]

        [hide_unit]
            id=Tenma
        [/hide_unit]

        [unit]
            {NIDDHON}
            side=9
            x=30
            y=21
        [/unit]

        [unit]
            {SHAKKHA}
            side=9
            x=32
            y=35
        [/unit]

        [set_variable]
            name=valerya_sacrifice
            value=0
        [/set_variable]

        [set_variable]
            name=yiwen_survived
            value=1
        [/set_variable]

        # Transfering units from side 1 to their respective Kings/Queens...
        # First, the Sylvan Host

        [store_unit]
            kill=yes
            variable=cornelya_army
            [filter]
                side=1
                type=Faun Soldier,Faun Marksman,Faun Sharpshooter,Faun Captain,Faun Lord,Anuran Rider,Faerie Sprite,Fire Faerie,Faerie Dryad,Faerie Spirit,Elvish Champion,Elvish Enchantress,Elvish Sharpshooter,Elvish Shyde,Ancient Wose,Elvish Hero,Elvish Marksman,Elvish Sorceress,Elvish Druid,Elder Wose,Black Elf Shaman,Black Elf Witch,Black Elf Caster,Black Elf Sylph,Black Elf Fighter,Black Elf Hero,Black Elf Dreadsword,Black Elf Barbarian,Black Elf Commander,Black Elf Marshal,Black Elf Crossbowman,Black Elf Marksman,Black Elf Slayer,Cave Rider,Cave Striker
                [not]
                    id=Shwarzel
                [/not]
                [not]
                    id=Umbrius
                [/not]
                [not]
                    id=Idunn
                [/not]
            [/filter]
        [/store_unit]

        [foreach]
            array=cornelya_army
            [do]
                {VARIABLE this_item.side 3}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE cornelya_army}

        # Burning Legion...

        [store_unit]
            kill=yes
            variable=veshtar_army
            [filter]
                side=1
                type=Inferno Drake,Drake Blademaster,Drake Enforcer,Hurricane Drake,Fire Drake,Drake Warrior,Drake Thrasher,Sky Drake,Saurian Ambusher,Saurian Flanker
            [/filter]
        [/store_unit]

        [foreach]
            array=veshtar_army
            [do]
                {VARIABLE this_item.side 4}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE veshtar_army}

        # Knalgan Army...

        [store_unit]
            kill=yes
            variable=algil_army
            [filter]
                side=1
                type=Dwarvish Lord,Dwarvish Runemaster,Dwarvish Dragonguard,Dwarvish Sentinel,Dwarvish Explorer,Dwarvish Steelclad,Dwarvish Runesmith,Dwarvish Thunderguard,Dwarvish Stalwart,Dwarvish Pathfinder,Dokkor Bladesman,Dokkor Archer,Dokkor Hammerer,Dokkor Spearman,Dokkor Horseman,Gryphon Rider,Dokkor Longswordsman,Dokkor Champion,Dokkor Fighter,Dokkor Warrior,Dokkor Berserker,Dokkor Crossbowman,Dokkor Arbalestier,Dokkor Longbowman,Dokkor Heavy Longbowman,Dokkor Hammerer,Dokkor Protector,Dokkor Nightmare Guard,Dokkor Halberdier,Dokkor Executioner,Dokkor Gunner,Dokkor Thunderstriker,Dokkor Pillager,Dokkor Knight,Dokkor Cataphract
                [not]
                    id=Augdras
                [/not]
            [/filter]
        [/store_unit]

        [foreach]
            array=algil_army
            [do]
                {VARIABLE this_item.side 5}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE algil_army}

        # Troll Army...

        [store_unit]
            kill=yes
            variable=udhark_army
            [filter]
                side=1
                type=Great Troll,Troll Warrior,Troll Boulderlobber,Troll,Troll Shaman,Troll Rocklobber
                [not]
                    id=Thrur
                [/not]
            [/filter]
        [/store_unit]

        [foreach]
            array=udhark_army
            [do]
                {VARIABLE this_item.side 6}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE udhark_army}

        # Oceanic Host...

        [store_unit]
            kill=yes
            variable=derceto_army
            [filter]
                side=1
                type=Merman Triton,Merman Hoplite,Merman Entangler,Merman Javelineer,Mermaid Siren,Mermaid Diviner,Merman Warrior,Merman Thunder Warrior,Merman Netcaster,Merman Spearman,Mermaid Enchantress,Mermaid Priestess,Naga Warrior,Naga Myrmidon,Cuttle Fish,Sea Serpent,Water Serpent
            [/filter]
        [/store_unit]

        [foreach]
            array=derceto_army
            [do]
                {VARIABLE this_item.side 7}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE derceto_army}

        # And finally, the Orcish Horde

        [store_unit]
            kill=yes
            variable=bogor_army
            [filter]
                type=Orcish Warlord,Orcish Slurbow,Orcish Sorcerer,Direwolf Rider,Orcish Warrior,Orcish Crossbowman,Orcish Warlock,Goblin Knight,Goblin Pillager
            [/filter]
        [/store_unit]

        [foreach]
            array=bogor_army
            [do]
                {VARIABLE this_item.side 8}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE bogor_army}

        #Valerya is going to sacrifice herself, and so she won't dodge Agadhor's attacks...
        {FORCE_CHANCE_TO_HIT id=Agadhor id=Valerya 100 ()}
    [/event]

    [event]
        name=start

        [modify_side]
            side=4
            controller=ai
        [/modify_side]
        [modify_side]
            side=5
            controller=ai
        [/modify_side]
        [modify_side]
            side=6
            controller=ai
        [/modify_side]
        [modify_side]
            side=7
            controller=ai
        [/modify_side]
        [modify_side]
            side=8
            controller=ai
        [/modify_side]

        {MODIFY_UNIT id=Valerya canrecruit no}
        {MODIFY_UNIT id=Aeldhoryan canrecruit no}
        {MODIFY_UNIT id=Ikki canrecruit no}
        {MODIFY_UNIT id=Ankhmare canrecruit no}

        [unit_overlay]
            id=Valerya
            image=misc/hero-icon.png
        [/unit_overlay]
        [unit_overlay]
            id=Aeldhoryan
            image=misc/hero-icon.png
        [/unit_overlay]
        [unit_overlay]
            id=Ankhmare
            image=misc/hero-icon.png
        [/unit_overlay]
        [unit_overlay]
            id=Ikki
            image=misc/hero-icon.png
        [/unit_overlay]

        [allow_recruit]
            side=1
            type=Wersefet,Medjay,Maryannu,Forest Mage,Thunder Mage,Crimson Mage,Cleric,Washraha Jackal Warrior,Washraja,Deshra Juggernaut,Deshra Flattener,Washraha Champion,Washraha Seeker,Deshra Warrior,Deshra Clubber,Chomi Ranger,Chomi Hero,Chomi Spear Thrower,Chomi Holy Father,Chomi Light Infantry,Chomi Javelineer,Chomi Soldier,Chomi Priest,Baryag Rider,Baryag Tracker,Baryag Raging Bear,Baryag Spy,Baryag Warlord,Baryag Ranger,Baryag Warfather,Volva,Norn,Wersefet,Medjay,Maryannu,Forest Mage,Thunder Mage,Crimson Mage,Cleric,Royal Guard,Grand Knight,Paladin,Arch Mage,Mage of Light,Silver Mage
        [/allow_recruit]

        [message]
            speaker=Olokun
            message= _ "Dragons, stand where you are and face us! Or have you become afraid of 'inferior beings' after your defeat to Maat?"
        [/message]
        [message]
            speaker=Agadhor
            message= _ "Fleeing? Afraid? Pitiful worm, we had no reason to fear you when we were mere Fire Dragons; now that we have become even greater than we were, you have no hope of surviving!"
        [/message]
        [message]
            speaker=Niddhon
            message= _ "Now, fallen warriors from the Dragon Age, this is our chance to achieve what we could not in the past! Let the world burn in your fire once more!"
        [/message]
        [message]
            speaker=Veshtar
            message= _ "It shames me that my people were once pledged their loyalty to the likes of you. Drakes and saurians, we are guilty for all this horror that haunts us from the olden days, so we must fight more fiercely than everyone else!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "No, Queen-in-the-Air, we must all fight with equal fierceness, for we are all children of Mother Demere, and this world is ours to defend! Now, to battle!"
        [/message]
    [/event]

    # Defeat deaths

    [event]
        name=last breath
        [filter]
            id=Cornelya
        [/filter]
        [message]
            speaker=Cornelya
            message= _ "Mother, I can't join you again yet...!"
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "CORNELYA, NO!!!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Kenshiro
        [/filter]
        [message]
            speaker=Kenshiro
            message= _ "C-Cornelya...!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "KENSHIRO!!!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Derceto
        [/filter]
        [message]
            speaker=Derceto
            message= _ "I can't... die... Olokun, I'm-"
        [/message]
        [message]
            speaker=Olokun
            message= _ "DERCETO, NO!!!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Algil
        [/filter]
        [message]
            speaker=Algil
            message= _ "Argh...! Curse them all..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Natsu
        [/filter]
        [message]
            speaker=Natsu
            message= _ "Aahhh!!! My... son..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "Mother, no!!!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Aeldhoryan
        [/filter]
        [message]
            speaker=Aeldhoryan
            message= _ "I have failed... my people..."
        [/message]
        [message]
            speaker=Natsu
            message= _ "AELDHORYAN!!!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Udhark
        [/filter]
        [message]
            speaker=Udhark
            message= _ "I cannot fail my people now..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Bogor
        [/filter]
        [message]
            speaker=Bogor
            message= _ "How could I fall to these puny maggots...?!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Dragana
        [/filter]
        [message]
            speaker=Dragana
            message= _ "Argh...! To fall... in the greatest of battles...!"
        [/message]
        [message]
            speaker=Aeldhoryan
            message= _ "No! We needed Dragana Vasilya to rebuild our nations!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    # Non-defeat deaths

    [event]
        name=last breath
        [filter]
            id=Donar
        [/filter]
        [message]
            speaker=Algil
            message= _ "DONAR!!!"
        [/message]
        [message]
            speaker=Donar
            message= _ "Argh! Damn, how pathetic of me to die before you..."
        [/message]
        [message]
            speaker=Algil
            message= _ "My brother...! How... how could I let my little brother die?!"
        [/message]
        [message]
            speaker=Donar
            message= _ "Gonna cry now, King-in-the-Earth...? Don't do that, not for me, for I fall covered in glory; when I arrive at the Halls of Heroes, I'll be amongst the few who can boast having died in the greatest battle of the ages, and by the side of the King-in-the-Earth who redeemed dwarf-kind..."
        [/message]
        [message]
            speaker=Algil
            message= _ "Then make sure to make even Hamel the Brave raise a horn in your honour! As for us who stay behind, we will make sure that the last thing our foes hear is your name!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Gelendras
        [/filter]
        [message]
            speaker=Cornelya
            message= _ "Brother, no!!!"
        [/message]
        [message]
            speaker=Gelendras
            message= _ "(panting) I go to father's side... But I go in peace, for I know... That I leave our people... in good hands..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "You were one of the most important people in my life, Gelendras... You accepted me with open arms, sharing father's love with a girl who didn't even share your blood... Rest with the First, my brother..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Idunn
        [/filter]
        [message]
            speaker=Umbrius
            message= _ "My love...!"
        [/message]
        [message]
            speaker=Idunn
            message= _ "Alas, we will never see our beloved valley again, husband..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Idunn, you were the closest I had to a mother after my blood mother died; you helped me heal my worst wounds, and so you helped me come to peace with myself. Rest with the First, for I promise I will not let your sacrifice be in vain."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Ankhmare
        [/filter]
        [message]
            speaker=Olokun
            message= _ "Master, no!!!"
        [/message]
        [message]
            speaker=Ankhmare
            message= _ "(smiling) Alas, my time on this world is over... But I have no regrets; I fall in the battle our people have been preparing for since our very first sunrise. Also, I go with the knowledge that I helped raise he who became the King-Under-the-Sun..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "And I am proud to have been your disciple, master... Now, rest in peace; I will make sure that New Maat'Kare still stands for generations to count."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Tallin
        [/filter]
        [message]
            speaker=Tallin
            message= _ "Thus dies the last Lord Protector of the Northern Alliance... Fight on, my friends..."
        [/message]
        [message]
            speaker=Udhark
            message= _ "I am deeply sorry that you could not enter the new era with us, my friend; but rest assured that, even if the Northern Alliance ends, its values shall live on through us!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Ikki
        [/filter]
        [message]
            speaker=Ikki
            message= _ "Agh! Natsu, please tell my daughter... I died with honour..."
        [/message]
        [message]
            speaker=Natsu
            message= _ "I wish we could've returned to Kodakuni and see the cherry trees as free people, but unfortunately, all I can do is promise I'll make sure your name is made immortal by the scrolls of Umashima. Rest in peace, noble Ikki."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Umbrius
        [/filter]
        [message]
            speaker=Idunn
            message= _ "Umbrius...!"
        [/message]
        [message]
            speaker=Umbrius
            message= _ "Ugh...! Apologies, my beloved... apologies, my queen... I can fight no longer...!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "It is I who must apologise for not being able to return you to your valley, Umbrius. Without you, I might never have fulfilled my destiny... Rest assured that your sacrifice will not be in vain â€“ this I swear."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Yiwen
        [/filter]

        [set_variable]
            name=yiwen_survived
            value=0
        [/set_variable]

        [message]
            speaker=Yiwen
            message= _ "Argh...! So this is how the last of the Windsong dies... (smirking) in the greatest of battles... I hope I've made you all proud, my sisters across the ages..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Shwarzel
        [/filter]
        [message]
            speaker=Shwarzel
            message= _ "To think that I'd fall so easily... But I regret nothing... Queen-in-the-Woods, please, do not forget your cousins from the underground..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Worry not, fair Svaryarna; our tribes have remained apart for far too long, I will not allow them to remain like this."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Augdras
        [/filter]
        [message]
            speaker=Augdras
            message= _ "To think that I would die fighting gloriously by the King-in-the-Earth's side... Thank you, Lord Algil, for giving me this honour..."
        [/message]
        [message]
            speaker=Algil
            message= _ "Go to the Halls of Heroes with pride, good Augdras, for your death has won our people their very lives."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Thrur
        [/filter]
        [message]
            speaker=Thrur
            message= _ "Alas, I die... But there is no shame or sadness in dying next to the long-awaited King-in-the-Abyss..."
        [/message]
        [message]
            speaker=Udhark
            message= _ "Return to the abyss in peace, brave Thrur, for you have died fighting for all the future generations of trolls."
        [/message]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Agadhor
        [/filter]

        {ADVANCE_UNIT (id=Agadhor) ()}
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Niddhon
        [/filter]

        {ADVANCE_UNIT (id=Niddhon) ()}
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Shakkha
        [/filter]

        {ADVANCE_UNIT (id=Shakkha) ()}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Agadhor
            [or]
                id=Shakkha
            [/or]
            [or]
                id=Niddhon
            [/or]
        [/filter]

        [message]
            speaker=Bogor
            message= _ "What devilry is this?! I'm sure that dragon got hit hard enough to disappear, and yet he's back at it again!?"
        [/message]
        [message]
            speaker=Agadhor
            message= _ "Pitiful vermin, I told you that our new power was beyond you!"
        [/message]
        [message]
            speaker=Olokun
            message= _ "I know what they're doing: whenever one of them is about to be destroyed, the other two recover him with an influx of soul energy..."
        [/message]
        [message]
            speaker=Algil
            message= _ "So we have to kill them at once?"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "It won't be easy, though; we'd have to do that at exactly the same time, and they're too far from each other for us to do that with a single attack..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "So, in the end, there <i>is</i> something that the mighty Kings and Queens of Irdya need of a mere mortal like myself?"
        [/message]
        [message]
            speaker=Derceto
            message= _ "What do you mean?"
        [/message]
        [message]
            speaker=Valerya
            message= _ "I think I've told some of you once that I own a Staff of Righteous Flame..."
        [/message]
        [message]
            speaker=Veshtar
            message= _ "(astonished) Did you say Righteous Flame? Does such art still exist?!"
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "I know this staff causes a massive explosion if its owner is killed, but what exactly it is?"
        [/message]
        [message]
            speaker=Veshtar
            message= _ "The Righteous Flame is an ancient lost technique of the dragons. When one who had mastered it perished, he could release all of his inner fire at once, in pure form. Legends say that it was a fire so intense that even dragons could be killed by it. I had heard that saurian mages in olden times had concentrated that fire into staffs, but I had no idea that such dangerous artefacts still existed..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "This might be the last of the kind, though. We're lucky to have this one; I found it by accident during one of my escapades from the Alduin Academy; I've always known skipping that class was a wise decision..."
        [/message]
        [message]
            speaker=Aeldhoryan
            message= _ "But, if this staff only works when it's owner is killed..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "Eh, well, that's the downside of it..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "No! Don't you even try it, Valerya, I won't let you do it!"
        [/message]
        [message]
            speaker=Valerya
            message= _ "Hush, I'm no folk of the forest and you're not my queen! Listen, friends, I may have mentioned this once or twice, but I'm very, very old. My time has long passed; I have seen so many friends of mine die, my mother, my aunts, my husband, my cousins... I don't know for how long the Fountain of Life will keep me going, but I know it'll be long enough to watch you, the first true friends I've had in centuries, die as well, and I've definitely had my share of losing loved ones..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "Valerya...!"
        [/message]
        [message]
            speaker=Valerya
            message= _ "And if I'm to die... well, I can think of no worthier way to die than this, helping you save our world. "
        [/message]
        [message]
            speaker=Veshtar
            message= _ "If this is your decision, Crimson Sorceress, then we, the Kings and the Queens of Irdya, shall open the way for you."
        [/message]
        [message]
            speaker=Valerya
            message= _ "(suddenly energetic) Then, to business! All I need you to do is to carve a path to the dragon in the middle; only from there will the Staff's range engulf the other two dragons. Also, make sure they are all weakened beforehand, otherwise even the Staff's explosion won't be enough to destroy them."
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Valerya must die next to Agadhor, and all the three dragons must have their HP lower than 100, for the Righteous Flame to destroy them"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of any of the Kings and Queens"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kenshiro"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Aeldhoryan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Natsu"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dragana"
                condition=lose
            [/objective]

            note=_"NOTE: Only the heroes and heroines mentioned in the Objectives must be kept alive.

Also, in this scenario, you have the choice to control the Kings and the Queens, and also their armies, by right-clicking anywhere on the screen."

            [gold_carryover]
                carryover_percentage=0
            [/gold_carryover]
        [/objectives]

        [set_variable]
            name=valerya_sacrifice
            value=1
        [/set_variable]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Valerya
        [/filter]
        [if]
            [variable]
                name=valerya_sacrifice
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Valerya
                    message= _ "(in pain) That's right, dragon... You have beaten me; here is your reward...!"
                [/message]

                [store_locations]
                    [filter]
                        id=Valerya
                    [/filter]

                    variable=valerya_location
                [/store_locations]

                [item]
                    halo=halo/righteous-flame.png
                    x=$valerya_location.x
                    y=$valerya_location.y
                [/item]

                {CLEAR_VARIABLE valerya_location}

                [message]
                    speaker=Agadhor
                    message= _ "What... This brilliance...!"
                [/message]
                [message]
                    speaker=Valerya
                    message= _ "It's just as Agnash used to say... In order to kill a dragon, you must learn to fight like one...!"
                [/message]
                [message]
                    speaker=Niddhon
                    message= _ "Human... How... <i>dare you</i>!"
                [/message]
                [message]
                    speaker=narrator
                    message= _ "From a safe distance, the fighters, bloodied and exhausted, watched as Valerya and the three ancient dragons were engulfed in light brighter than the suns; and then, the light became fire, and the fire shook the very earth as it erupted..."
                [/message]

                [color_adjust]
                    red=150
                    green=100
                    blue=100
                [/color_adjust]
                [sound]
                    name=dragon-flames.ogg
                [/sound]

                [delay]
                    time=800
                [/delay]

                [color_adjust]
                    red=0
                    green=0
                    blue=0
                [/color_adjust]
                [delay]
                    time=10
                [/delay]

                [sound]
                    name=gun-energy-huge-fire.ogg
                [/sound]

                [harm_unit]
                    [filter]
                        race=undead
                    [/filter]

                    animate=yes
                    kill=yes
                    amount=110
                    alignment=neutral
                    damage_type=fire
                [/harm_unit]

                [kill]
                    id=Valerya
                [/kill]

                [message]
                    speaker=narrator
                    message= _ "As the flames subsided, a northern gale dispersed the smoke, revealing the crater where Valerya, the Crimson Sorceress, had made her last stand."
                [/message]

                [remove_item][/remove_item]
                [redraw][/redraw]

                [delay]
                    time=600
                [/delay]
                [if]
                    [have_unit]
                        id=Agadhor
                        [or]
                            id=Niddhon
                        [/or]
                        [or]
                            id=Shakkha
                        [/or]
                    [/have_unit]
                    [then]
                        [role]
                            type=Dragon of Death
                            role=Dragon
                        [/role]

                        [message]
                            role=Dragon
                            message= _ "Pathetic! You gave up your life trying to destroy us, and yet here we stand!"
                        [/message]
                        [message]
                            speaker=Cornelya
                            message= _ "No! How could we let her die in vain?!"
                        [/message]

                        [endlevel]
                            result=defeat
                        [/endlevel]
                    [/then]
                    [else]
                        [replace_map]
                            map="{~add-ons/Aria_of_the_Dragon_Slayer/maps/49_The_Children_Of_Demere_second.map}"
                            expand=yes
                            shrink=yes
                        [/replace_map]

                        [message]
                            speaker=Veshtar
                            message= _ "The Dragons of Death are no more, and so their foul hordes are reduced to ash!"
                        [/message]
                        [message]
                            speaker=Cornelya
                            message= _ "Thank you, Valerya... Thank you for everything..."
                        [/message]
                        [message]
                            speaker=Kenshiro
                            message= _ "I am honoured to have fought by your side, my friend..."
                        [/message]
                        [message]
                            speaker=Olokun
                            message= _ "Like the High Ascendant Maat long ago, you gave your life to stop the Three Dragons; and like Maat's, your name shall be forever engraved in the memory of our people..."
                        [/message]

                        {THUNDER_LIGHTNING}

                        [message]
                            speaker=Algil
                            message= _ "This noise... It came from where Tenma has gone!"
                        [/message]
                        [message]
                            speaker=Cornelya
                            message= _ "Then, that means...!"
                        [/message]

                        [color_adjust]
                            red=25
                            green=25
                            blue=25
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        [color_adjust]
                            red=50
                            green=50
                            blue=50
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        [color_adjust]
                            red=75
                            green=75
                            blue=75
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        [color_adjust]
                            red=100
                            green=100
                            blue=100
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        [color_adjust]
                            red=125
                            green=125
                            blue=125
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        [color_adjust]
                            red=150
                            green=150
                            blue=150
                        [/color_adjust]
                        [delay]
                            time=100
                        [/delay]

                        {MODIFY_UNIT id=Cornelya side 1}
                        {MODIFY_UNIT id=Algil side 1}
                        {MODIFY_UNIT id=Udhark side 1}
                        {MODIFY_UNIT id=Derceto side 1}
                        {MODIFY_UNIT id=Bogor side 1}
                        {MODIFY_UNIT id=Veshtar side 1}
                        {MODIFY_UNIT id=Natsu side 1}
                        {MODIFY_UNIT id=Kenshiro side 1}
                        {MODIFY_UNIT id=Aeldhoryan side 1}

                        [store_unit]
                            [filter]
                                id=Olokun
                            [/filter]
                            variable=olokun_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Cornelya
                            [/filter]
                            variable=cornelya_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Algil
                            [/filter]
                            variable=algil_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Udhark
                            [/filter]
                            variable=udhark_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Derceto
                            [/filter]
                            variable=derceto_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Bogor
                            [/filter]
                            variable=bogor_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Veshtar
                            [/filter]
                            variable=veshtar_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Natsu
                            [/filter]
                            variable=natsu_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Kenshiro
                            [/filter]
                            variable=kenshiro_final
                            kill=yes
                        [/store_unit]

                        [store_unit]
                            [filter]
                                id=Aeldhoryan
                            [/filter]
                            variable=aeldhoryan_final
                            kill=yes
                        [/store_unit]

                        [kill]
                            [not]
                                id=Tenma
                            [/not]
                        [/kill]

                        [endlevel]
                            result=victory
                            carryover_report=no
                            linger_mode=no
                            bonus=no
                        [/endlevel]
                    [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=Valerya
                    message= _ "Not... yet...!"
                [/message]

                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]
[/scenario]
