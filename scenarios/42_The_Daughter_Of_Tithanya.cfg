#textdomain wesnoth-Aria_of_the_Dragon_Slayer

[scenario]
    id=42_The_Daughter_Of_Tithanya
    name= _ "The Daughter of Tithanya"
    next_scenario=43_Twin_Hammers
    map_data="{~add-ons/Aria_of_the_Dragon_Slayer/maps/42_The_Daughter_Of_Tithanya.map}"
    {TURNS 48 44 40}
    {STORMY_SKY}

    {SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC overlive.ogg}
    {EXTRA_SCENARIO_MUSIC weight_of_revenge.ogg}

    {WEAPON_SPECIALS_EVENTS}
    {DRAGONSLAYER_TRANSFORMATION}
    {FREEZING_EVENTS}

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                description= _ "Defend Metheldur from Wesir's attack"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Cornelya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kenshiro"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Gil-Thelyon"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dragana"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Gelendras"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Garlin Ohn"
                condition=lose
            [/objective]

            {AI_CONTROLLER_NOTE}
            {TURNS_RUN_OUT}

            note = _ "In this scenario, units exposed to the elements will suffer the effects of the Wesir's death blizzard, losing 2 HP per turn unless protected by healers. Staying inside a castle, village or keep, or taking shelter beneath the trees, will nullify the freezing's effects. Woses are immune to this effect."

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    {DAUGHTER_OF_TITHANYA_STORY}
    {STARTING_VILLAGES 1 7}
    {STARTING_VILLAGES 2 12}
    {STARTING_VILLAGES 3 8}
    {STARTING_VILLAGES 4 8}

    [side]
        {TENMA}
        recruit=
        {GOLD 260 240 200}
        {INCOME 12 9 6}
        team_name=teamtenma
        user_team_name=_"Travellers"

        {FLAG_VARIANT6 ragged}
    [/side]

    {AI_CONTROLLER () 1 3,4,5 ()}

    [side]
        {WESIR_UNDEAD}
        recruit=Draug,Banebow,Ghast,Lich,Spectre,Bone Knight
        side=2
        team_name=undead
        user_team_name=_"Wesir Amarnat"
        {GOLD 1300 1400 1500}
        {INCOME 60 80 100}
        [ai]
            recruitment_pattern=fighter,fighter,archer,archer,scout,scout
            [goal]
                name=target
                [criteria]
                    id=Thelyon
                [/criteria]
                value=70
            [/goal]
            [goal]
                name=target
                [criteria]
                    id=Cornelya
                [/criteria]
                value=80
            [/goal]
        [/ai]
        {FLAG_VARIANT undead}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Lich) 5}

    [side]
        {GILTHELYON}
        recruit=Elvish Enchantress,Elvish Sharpshooter,Elvish Champion,Elvish Shyde,Ancient Wose,Elvish Sorceress,Elvish Marksman,Elvish Lord,Elvish Druid,Elder Wose
        side=3
        team_name=teamtenma
        user_team_name=_"Lins-Elens Elves"
        {GOLD 700 650 600}
        {INCOME 25 20 10}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,mixed fighter,archer,healer
            aggression=0.65
            caution=0.35
        [/ai]

        {FLAG_VARIANT wood-elvish}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Elvish Enchantress) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Elvish Shyde) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Elvish Sharpshooter) 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Elvish Champion) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Ancient Wose) 2}

    [side]
        {DRAGANA}
        recruit=Baryag Rider,Baryag Tracker,Baryag Raging Bear,Baryag Spy,Baryag Warlord,Baryag Ranger,Baryag Warfather,Volva,Norn
        side=4
        team_name=teamtenma
        user_team_name=_"Baryags"
        {GOLD 450 420 390}
        {INCOME 20 15 10}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter,healer
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT long}
    [/side]

    [side]
        id=Garlin
        name=_"Garlin Ohn"
        type=Inferno Drake
        canrecruit=yes
        recruit=Fire Drake,Drake Thrasher,Sky Drake
        side=5
        team_name=teamtenma
        user_team_name=_"Kehshakaar Drakes"
        {GOLD 380 350 320}
        {INCOME 20 15 10}
        [ai]
            {AI_SIMPLE_ALWAYS_ASPECT village_value 0}
            passive_leader=yes
            recruitment_pattern=fighter,fighter,archer,archer,archer,scout
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT loyalist}
    [/side]

    [event]
        name=prestart

        [unit]
            {GELENDRAS}
            side=3
            x=39
            y=39
        [/unit]

        [unit]
            id=Kaldan
            name=_"Sage Kaldan"
            type=Elvish High Lord
            canrecruit=yes
            side=3
            x,y=29,27
        [/unit]

        [store_unit]
            [filter]
                id=Tenma
            [/filter]
            variable=tenma_provisory_two
            kill=yes
        [/store_unit]

        [store_unit]
            [filter]
                id=Veshtar
            [/filter]
            variable=veshtar_store
            kill=yes
        [/store_unit]

        [store_unit]
            [filter]
                id=Aeldhoryan
            [/filter]
            variable=aeldhoryan_store
            kill=yes
        [/store_unit]

        {FORCE_CHANCE_TO_HIT side=2 id=Thelyon 80 ()}

        # This time I'm storing the human units that appeared with Aeldhoryan in the previous scenario along with the elementals

        [store_unit]
            kill=yes
            variable=true_elementals_two
            [filter]
                side=1
                type=Air Spirit,Fire Spirit,Water Spirit, Earth Spirit, Air Embodiment,Fire Embodiment,Water Embodiment,Earth Embodiment,Gali,Niti,Agni,Bhumi,Mage of Light,Dune Wayfarer,Dune Harrier,Dune Luminary,Dune Sky Hunter
            [/filter]
        [/store_unit]

        [unstore_unit]
            variable=cornelya5_store
            x,y=5,35
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE cornelya5_store}

        [unstore_unit]
            variable=kenshiro_store
            x,y=6,35
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE kenshiro_store}

        [foreach]
            array=cornelya_army_woodlander
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [foreach]
            array=cornelya_army_faerie
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [foreach]
            array=cornelya_army_blackelf
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [clear_variable]
            name=cornelya_army_woodlander,cornelya_army_faerie,cornelya_army_blackelf
        [/clear_variable]

        {NAMED_LOYAL_UNIT 4 (Queensguard) 27 37 (Adela) ("Adela")} {GUARDIAN}
        {NAMED_LOYAL_UNIT 4 (Queensguard) 29 37 (Larisa) ("Larisa")} {GUARDIAN}
        {NAMED_LOYAL_UNIT 4 (Queensguard) 31 37 (Vladimira) ("Vladimíra")} {GUARDIAN}

        {LOYAL_UNIT 2 (Lich) 38 1} {GUARDIAN}
        {LOYAL_UNIT 2 (Lich) 40 1} {GUARDIAN}
        {LOYAL_UNIT 2 (Lich) 38 3} {GUARDIAN}
        {LOYAL_UNIT 2 (Lich) 40 3} {GUARDIAN}

        {LOYAL_UNIT 3 (Elder Wose) 28 16} {GUARDIAN}
        {LOYAL_UNIT 3 (Elder Wose) 36 16} {GUARDIAN}
        {LOYAL_UNIT 3 (Elder Wose) 46 15} {GUARDIAN}
        {LOYAL_UNIT 3 (Elder Wose) 23 18} {GUARDIAN}
        {LOYAL_UNIT 3 (Elder Wose) 32 22} {GUARDIAN}
        {LOYAL_UNIT 3 (Elder Wose) 36 22} {GUARDIAN}

        [set_variable]
            name=cornelya_duel
            value=0
        [/set_variable]


			[allow_extra_recruit]
				id=Cornelya
				extra_recruit=Wose,Elder Wose
			[/allow_extra_recruit]


        {FORCE_CHANCE_TO_HIT side=1,3,4,5 id=Wesir 0 ()}
        #Because we all know how drakes are prone to getting hit, right?
        {FORCE_CHANCE_TO_HIT side=2 id=Garlin 20 ()}
    [/event]

    [event]
        name=start

        [message]
            speaker=Thelyon
            message= _ "And so the monster who brings this unnatural winter finally reveals his face... Tell us, necromancer: who are you, and who do you fight for? Are you another one of Wesnoth's 'White Necromancers', sent to expand the empire's frontiers?"
        [/message]
        [message]
            speaker=Wesir
            message= _ "I do not fight for that petty empire, elf king; I am Wesir Amarnat, known in my native New Maat'Kare as the 'God of Death', and I fight only for myself!"
        [/message]
        [message]
            speaker=Kaldan
            message= _ "Yours must be an insignificant nation indeed, for I have never even heard of it before. Just as ignominious shall be your end, if you dare attack Metheldur!"
        [/message]
        [message]
            speaker=Wesir
            message= _ "You may not know my homeland, but I have read about yours: my people's writings on you are ancient, but elven civilisation seems hostile to the idea of progress, even of the magic kind, for you are just as I expected you to be..."
        [/message]
        [message]
            speaker=Thelyon
            message= _ "We strive for peace and balance, necromancer; we have reached both long ago, and so we have endured the aeons - while those who practice the dark arts invariably fall under the weight of their own corruption."
        [/message]
        [message]
            speaker=Wesir
            message= _ "And so even the wise elves are blinded by the same prejudices of every other primitive culture. My people have long learned to master the dark arts without being mastered by them; this is why we are so powerful. Your failure to understand that, like your failure to know the powers that thrive beyond the oceans, shall be your undoing, elves."
        [/message]
        [message]
            speaker=Kaldan
            message= _ "Let loose your foul hordes, then, and see how they crash hopelessly against the might of the Lins-Elens!"
        [/message]
        [message]
            speaker=Wesir
            message= _ "So they would, had I attacked another time... But I know you've been through a terrible war not that long ago. Shall we see if your might can still withstand mine?"
        [/message]
        [message]
            speaker=Dragana
            message= _ "Damn it...! It's bad enough he's chosen our weakest moment to attack, but his power truly is no jest. I have seen it with my own eyes, friends: it's as if he opens the gates to the Beyond itself to pour all its endless hordes into our world, along with its freezing gales. I'm almost forced to believe that he is Czernabog the Dark himself..."
        [/message]
        [message]
            speaker=Gelendras
            message= _ "Many were the necromancers throughout history who wielded uncanny powers; as they all fell, so will he. Elves, Baryags, let us fight side by side against this-"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "(frowning) Gelendras, hold on, please... (brief pause) This presence... Could it be...?"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Father, you ordered me to protect the humans until the end of their journey; so I have done, and so I return home!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "My heart sings to see you returned safe and sound, daughter; would that we had time for a calm conversation, but alas, I must ask you to help in the defence of our city!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "That was the very reason we hurried here, father - and I do not come alone. Fauns, faeries, this is the moment of reunion that you have sought for so long: let the Children of the Forest fight side by side once more!"
        [/message]
        [message]
            speaker=Gelendras
            message= _ "Those are the Lost Folk! To think we reunite just as Metheldur faces its gravest challenge in aeons..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "(to Kenshiro) Listen, I know that you have nothing to do with the Lins-Elens, so I'll understand if you choose to stay out, but-"
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "Do you seriously believe I'd flee a battlefield and leave you fighting alone? This may not be my country, but it's yours, and it means everything to you, so it means everything to me as well."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "(smiling) You fool, don't make me blush like this in front of my warriors... Still, I'm glad to have you by my side, Kenshiro. Now, to battle!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "*So not only have you managed to reunite the Children of Faerie after thousands of years, you've also learned to love again... Tenma Yozora, you have no idea of how grateful I am to you and your friends...*"
        [/message]
    [/event]

    [event]
        name=turn 2

        [message]
            speaker=Cornelya
            message= _ "I never thought I'd see Metheldur like this, blanketed in snow... Even when the worst winter storms blow from the north, these forests remain ever green, but now..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "Olokun did say Wesir was one of New Maat'Kare's most celebrated mages; I hate to admit, but he's held back a lot when we fought him back then."
        [/message]

    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            side=1,3,4
            [not]
                race=wose,elemental,trueelemental
            [/not]
            [not]
                id=Thelyon
            [/not]
        [/filter]

        [unit]
            name= _ "Fallen Friend"
            type={ON_DIFFICULTY "Walking Corpse" "Soulless" "Soulless"}
            side=2
            x=$x1
            y=$y1
            placement=map
            overwrite=yes
            moves=0
            attacks_left=0
            animate=yes
        [/unit]
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            side=5
        [/filter]

        [unit]
            name= _ "Fallen Friend"
            type={ON_DIFFICULTY "Walking Corpse" "Soulless" "Soulless"}
            side=2
            x=$x1
            y=$y1
            variation=drake
            placement=map
            overwrite=yes
            moves=0
            attacks_left=0
            animate=yes
        [/unit]
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            race=wose
        [/filter]

        [unit]
            name= _ "Fallen Friend"
            type={ON_DIFFICULTY "Walking Corpse" "Soulless" "Soulless"}
            side=2
            x=$x1
            y=$y1
            variation=wose
            placement=map
            overwrite=yes
            moves=0
            attacks_left=0
            animate=yes
        [/unit]
    [/event]

    [event]
        name=last breath
        [filter]
            side=1,3,4,5
        [/filter]

        [message]
            speaker=Kaldan
            message= _ "What profanity is that? He brings our fallen under his dark sway as soon as they die!"
        [/message]
        [message]
            speaker=Dragana
            message= _ "Just like that Wesnothian prince did in the service of the drakes. Good thing we're practised against such a tactic!"
        [/message]
    [/event]

    [event]
        name=turn 8

        [message]
            speaker=Wesir
            message= _ "You fight well, as I expected of the people of Alenya... Perhaps I should stop holding back and start fighting more seriously..."
        [/message]
        [message]
            speaker=Gelendras
            message= _ "I don't believe it... During all this time, was he just toying with us?!"
        [/message]
        [message]
            speaker=Wesir
            message= _ "Behold the might of Maat'Kare's lore! Let the Reign of Darkness begin!"
        [/message]

        [time_area]
            x=1
            y=1
            id=dark_heavens
            radius=100
            {DARK_HEAVENS}
        [/time_area]

        [modify_side]
            side=2
            {GOLD 750 800 900}
        [/modify_side]

        [message]
            speaker=Dragana
            message= _ "Damn him, he's managed to cloud even the sun!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "This bodes badly, neither the Baryags nor the woses fight well in this darkness... My people, let the symphony of your steel echo at its highest!"
        [/message]

        [modify_side]
            side=3
            {GOLD 350 300 250}
        [/modify_side]
    [/event]

    [event]
        name=side 2 turn 12

        [message]
            speaker=Wesir
            message= _ "I will acknowledge this, elves; if this is you at your weakest, I would never have posed a threat to you at your strongest. But you are weak nonetheless, whilst I am at the peak of my powers. This is the end for you, 'Children of the Forest'..."
        [/message]

        {BLACK_LIGHTNING}
        {SCATTER_GUARDIAN 6 "Revenant" 4 "Gg,Rp,Cv,Gll^Fp,Hh" "10-55" "8-25" 2 ()}
        {SCATTER_GUARDIAN 6 "Bone Shooter" 4 "Gg,Rp,Cv,Gll^Fp,Hh" "10-55" "8-25" 2 ()}

        [message]
            speaker=Kenshiro
            message= _ "Damn it, how can he make so many undead appear all over the forest?!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "He's raising long-dead elves from their graves, elves who remains we never purified because we never believed a necromancer would one day reach Metheldur's own walls... Wesir, you will pay for defiling the corpses of our ancestors!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "Worse still, it has caught our warriors by surprise; everyone, find the nearest comrade and stay together, or else-"
        [/message]

        {GENERIC_UNIT 2 (Draug) 33 32}
        {GENERIC_UNIT 2 (Draug) 33 33}
        {GENERIC_UNIT 2 (Draug) 34 31}
        {GENERIC_UNIT 2 (Draug) 34 33}
        {GENERIC_UNIT 2 (Draug) 35 32}
        {GENERIC_UNIT 2 (Draug) 35 33}

        [message]
            speaker=Gelendras
            message= _ "No..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Father, watch out!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "Even the Sylvan Blades have been affected by his curse...! (shouting) Gelendras, Cornelya, this is an order: do not risk your own lives for me, protect yourselves and the ones next to you, lest we are all doomed!"
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Thelyon
        [/filter]

        [message]
            speaker=Cornelya
            message= _ "FATHER, NO!!!"
        [/message]
        [message]
            speaker=Thelyon
            message= _ "My son... Please, protect our city... And you, my daughter... Do not let darkness... overcome you..."
        [/message]

        [role]
            type=Elvish Enchantress,Elvish Champion,Elvish Sorceress,Elvish Lord
            role=Elf
        [/role]

        [message]
            role=Elf
            message= _ "No... No way... Even the King-in-the-Woods has fallen before this necromancer...!"
        [/message]
        [message]
            speaker=Gelendras
            message= _ "(fighting tears) What is the meaning of that, warrior?! Why do you lose heart?! Our king has fallen, but our city still stands, our people still live, and our hearts still beat with fury! Fight on!"
        [/message]
    [/event]

    [event]
        name=turn 14

        [unstore_unit]
            variable=tenma_provisory_two
            x,y=50,32
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE tenma_provisory_two}

        [unstore_unit]
            variable=aeldhoryan_store
            x,y=51,32
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE aeldhoryan_store}

        [unstore_unit]
            variable=natsu_store
            x,y=51,33
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE natsu_store}

        [unstore_unit]
            variable=ikki_store
            x,y=52,33
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE ikki_store}

        [foreach]
            array=true_elementals_two
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [foreach]
            array=sogen_army
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [clear_variable]
            name=true_elementals_one,sogen_army
        [/clear_variable]

        [gold]
            side=1
            amount=400
        [/gold]

        [scroll_to_unit]
            id=Tenma
        [/scroll_to_unit]

        [message]
            speaker=Wesir
            message= _ "(enraged) You!!!"
        [/message]
        [message]
            speaker=Tenma
            message= _ "(panting) Good thing we made it in time... Just as I thought, the necromancer is the 'God of Jealousy' of New Maat'Kare... Wesir, your quarrel with me and Ankhmare has nothing to do with elves, Baryags or drakes, so why are you trying to destroy them?"
        [/message]
        [message]
            speaker=Wesir
            message= _ "Every new empire rises over the corpse of a weakened predecessor; the elves' kingdom would have been the biggest obstacle to me, but it's grown weaker by war - and now its corpse shall be the foundation of my empire. Now, be a good girl and DIE!"
        [/message]
        [message]
            speaker=Tenma
            message= _ "Give it your worst, you corrupt bag of bones! (to her friends) Kenshiro, Cornelya, I'm so glad you're safe... But where are the others?"
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "They've gone searching for Udhark in the Heart Mountains... Wait, are those my mother and... Prince Aeldhoryan?"
        [/message]
        [message]
            speaker=Natsu
            message= _ "(smiling radiantly) Is that the way you speak to your father? Come here, son, I missed you so..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "(embarrassed) Not now, mother, we're in the middle of a battle!"
        [/message]
        [message]
            speaker=Aeldhoryan
            message= _ "He's right, my love, he can't abandon his position. That means we'll have to open our way to him. Come, I'll shield you while you smite the undead!"
        [/message]

        [objectives]
            side=1
            [objective]
                description= _ "Destroy Wesir"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Tenma"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Kenshiro"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cornelya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Aeldhoryan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Natsu"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Dragana"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Ikki"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Gelendras"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=attack
        first_time_only=no
        [filter]
            id=Cornelya
        [/filter]
        [if]
            [not]
                [have_unit]
                    id=Thelyon
                [/have_unit]
            [/not]
            [have_unit]
                id=Tenma
            [/have_unit]
            [variable]
                name=cornelya_duel
                numerical_equals=0
            [/variable]
            [then]
                [set_variable]
                    name=cornelya_duel
                    value=1
                [/set_variable]

                [message]
                    speaker=Cornelya
                    message= _ "I'd already lost two parents to senseless violence... And now, because you bring war to our home, I have lost another...! Hide behind your monsters like the coward you are, it shall not avail you; it's by my hand that you'll be destroyed, Wesir of Maat'Kare!!!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "A coward, you call me... Very well, little princess, I accept your challenge."
                [/message]

                [store_locations]
                    [filter]
                        id=Cornelya
                    [/filter]

                    variable=cornelya_location
                [/store_locations]

                [teleport]
                    [filter]
                        id=Wesir
                    [/filter]
                    x,y=$cornelya_location.x,$cornelya_location.y
                [/teleport]

                {CLEAR_VARIABLE cornelya_location}

                [message]
                    speaker=Kenshiro
                    message= _ "Cornelya, WATCH OUT!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "I have killed your father, desecrated your ancestors, and butchered your people; what are you going to do about it, little elf?"
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "You...!!!"
                [/message]

                [objectives]
                    side=1
                    [objective]
                        description= _ "Destroy Wesir with Cornelya"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Tenma"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Kenshiro"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Cornelya"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Aeldhoryan"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Natsu"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Dragana"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Ikki"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Gelendras"
                        condition=lose
                    [/objective]

                    {TURNS_RUN_OUT}

                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Cornelya
        [/filter]
        [if]
            [variable]
                name=cornelya_duel
                numerical_equals=1
            [/variable]
            [then]
                [message]
                    speaker=Wesir
                    message= _ "Pathetic... Is this what you made me leave my camp for, little princess? Is this what you call fighting? The path of steel was never mine, but perhaps I could teach you a lesson or two..."
                [/message]

                {CINE_FIGHT "Cornelya" "Wesir" "supreme_umbra_two" yes no 60 cold}

                [message]
                    speaker=Kenshiro
                    message= _ "CORNELYA!!!"
                [/message]
                [message]
                    speaker=Gelendras
                    message= _ "Sister, not you too!!!"
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "Damn it, there are so many cursed undead on the way...!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "Perhaps you assessed me from our clash in New Maat'Kare, but then, little princess, I was holding back. <i>This</i> is the true difference in our powers. Learn it, and understand how little hope you, and your kingdom, have of defeating me!"
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "(in pain) I... won't..."
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "Stubborn to the end... Very well, for your spirit and your defiance, you shall be made an example of. You won't merely die; your very soul shall be crushed with despair and humiliation, and once you have become lower than the vermin that feed off carcasses, then you will die and be instilled with dark magic. You will make a fine Banebow for my army, perhaps even a Ghast; your people will look at you and they will know the reward for Metheldur's defiance..."
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "YOU SICK BASTARD, DON'T YOU DARE LAY A FINGER ON HER!!!"
                [/message]

                [store_locations]
                    [filter]
                        id=Cornelya
                    [/filter]

                    variable=cornelya_location2
                [/store_locations]

                [teleport]
                    [filter]
                        id=Kenshiro
                    [/filter]
                    x,y=$cornelya_location2.x,$cornelya_location2.y
                [/teleport]

                {CLEAR_VARIABLE cornelya_location2}

                [message]
                    speaker=Wesir
                    message= _ "(grinning) And I know how to begin your destruction..."
                [/message]

                {CINE_FIGHT "Kenshiro" "Wesir" "chill tempest" yes no 100 cold}

                {REPLACE_SCENARIO_MUSIC silence.ogg}

                [delay]
                    time=600
                [/delay]

                [message]
                    speaker=Cornelya
                    message= _ "No..."
                [/message]
                [message]
                    speaker=Natsu
                    message= _ "Kenshiro...!"
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "C-Cor..."
                [/message]

                {CINE_FIGHT "Kenshiro" "Wesir" "chill tempest" yes no 100 cold}

                [message]
                    speaker=Cornelya
                    message= _ "St-t-top..."
                [/message]

                {CINE_FIGHT "Kenshiro" "Wesir" "chill tempest" yes no 100 cold}

                [message]
                    speaker=Cornelya
                    message= _ "(in despair) No.. stop it..."
                [/message]

                {CINE_FIGHT "Kenshiro" "Wesir" "chill tempest" yes no 100 cold}

                [message]
                    speaker=Cornelya
                    message= _ "(crying) STOP IT!!! I beg you... don't...!"
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "No... no way...."
                [/message]
                [message]
                    speaker=Aeldhoryan
                    message= _ "My son...!"
                [/message]
                [message]
                    speaker=Natsu
                    message= _ "Kenshiro..."
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "C-Corn-nelya, I..."
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "No... please, spare your energies... I'll call a druid to heal you..."
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "I... l-lov-"
                [/message]

                [delay]
                    time=1000
                [/delay]

                [hide_unit]
                    id=Kenshiro
                [/hide_unit]

                [message]
                    speaker=Cornelya
                    message= _ "K-Kenshiro...?"
                [/message]

                [delay]
                    time=800
                [/delay]

                [message]
                    speaker=Cornelya
                    message= _ "Hold on, Kenshiro... I'll heal you myself..."
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "(crying) Cornelya...!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "If you want to blame anyone, little elf, blame Ankhmare and his puppy, Tenma Yozora; had they not forced me to leave my city, none of this would have happened..."
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "(crying) No..."
                [/message]

                [delay]
                    time=600
                [/delay]

                [message]
                    speaker=Cornelya
                    message= _ "(crying) Kenshiro, you... You promised to always stay by my side, didn't you... So why aren't you...?"
                [/message]

                [delay]
                    time=600
                [/delay]

                [message]
                    speaker=Cornelya
                    message= _ "KENSHIRO, DON'T LEAVE ME!!!"
                [/message]

                {FAERIE_STORM}
                {REPLACE_SCENARIO_MUSIC love_theme.ogg}

                [message]
                    speaker=Wesir
                    message= _ "Arcane tempest...!"
                [/message]

                [teleport]
                    [filter]
                        id=Wesir
                    [/filter]
                    x,y=38,3
                [/teleport]

                [message]
                    speaker=Cornelya
                    message= _ "*Tithanya... I won't flee my destiny any more... I won't forsake your blood any more... I'll be whatever you meant me to be... So I beg you... give me the power to save him...!!!*"
                [/message]

                {FAERIE_STORM}

                [unhide_unit]
                    id=Kenshiro
                [/unhide_unit]

                [heal_unit]
                    [filter]
                        id=Kenshiro
                    [/filter]
                    amount=5
                    animate=yes
                [/heal_unit]
                [delay]
                    time=100
                [/delay]

                [heal_unit]
                    [filter]
                        id=Kenshiro
                    [/filter]
                    amount=15
                    animate=yes
                [/heal_unit]
                [delay]
                    time=100
                [/delay]

                [heal_unit]
                    [filter]
                        id=Kenshiro
                    [/filter]
                    amount=32
                    animate=yes
                [/heal_unit]
                [delay]
                    time=100
                [/delay]

                [message]
                    speaker=Gelendras
                    message= _ "(astonished) Sister, what are you...?"
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "She's finally embraced the faerie plane again... and so awakened her true power..."
                [/message]

                {FAERIE_STORM}

                [heal_unit]
                    [filter]
                        id=Kenshiro
                    [/filter]
                    amount=80
                    animate=yes
                [/heal_unit]
                [delay]
                    time=100
                [/delay]

                {FAERIE_STORM}
                [delay]
                    time=500
                [/delay]
                {FAERIE_STORM}
                [delay]
                    time=500
                [/delay]
                {FAERIE_STORM}

                [store_locations]
                    [filter]
                        id=Cornelya
                    [/filter]

                    variable=cornelya_location3
                [/store_locations]

                [kill]
                    id=Cornelya
                [/kill]

                [delay]
                    time=200
                [/delay]

                [unit]
                    {CORNELYA_QUEEN}
                    animate=yes
                    x=$cornelya_location3.x
                    y=$cornelya_location3.y
                [/unit]

                [scroll_to_unit]
                    id=Cornelya
                [/scroll_to_unit]
                [delay]
                    time=600
                [/delay]
                {CLEAR_VARIABLE cornelya_location3}

                [message]
                    speaker=Kenshiro
                    message= _ "(panting heavily) What... What has...?!"
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "(smiling radiantly) Kenshiro...! How are you feeling...?"
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "I'm fine, but... <i>Should</i> I be fine? Last time I remember was-"
                [/message]
                [message]
                    speaker=narrator
                    message= _ "<i>Cornelya hugs him</i>"
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "(crying) You idiot, don't you ever scare me like this again, understand?! I nearly... I nearly..."
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "(smiling) He's just come back to the Living World and already you're trying to kill him again, that's so like you... (louder) Anyway, I'm sorry to break the mood, but this is not the time for that, Queen-in-the-Woods! Your people awaits your command!"
                [/message]
                [message]
                    speaker=Cornelya
                    message= _ "Queen-in-the-Woods? Why..."
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "Oh, come on, don't tell me you haven't noticed that you're literally bursting with faerie power?! This is what you were always meant to become, Cornelya – what you refused to become for so many years. But now you finally have, and so the blood of Tithanya could finally manifest itself."
                [/message]
                [message]
                    speaker=Gelendras
                    message= _ "Elves, the King-in-the-Woods may have fallen, but he left us a fitting heiress! All hail Cornelya, the Queen-in-the-Woods!!!"
                [/message]

                {REPLACE_SCENARIO_MUSIC ambuscade.ogg}
                {APPEND_MUSIC moleman.ogg}
                {APPEND_MUSIC casualties_of_war.ogg}
                {APPEND_MUSIC the_city_falls.ogg}

                [message]
                    speaker=Cornelya
                    message= _ "I'm not sure I deserve a crown, but one thing I know: this forest is my domain, and I shall not allow these undead to soil it any longer!"
                [/message]
                [message]
                    speaker=Tenma
                    message= _ "By the way, Natsu, Aeldhoryan, that elf is your daughter-in-law."
                [/message]
                [message]
                    speaker=Natsu
                    message= _ "!!!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "Damn it all, I cannot fight this new power and the pretender at the same time... You have caught me off guard, little elf; enjoy your victory, if you can!"
                [/message]

                [unit]
                    id=Skeledragon
                    name=_"Undead Dragon"
                    type=Skeletal Dragon
                    canrecruit=yes
                    side=2
                    x,y=39,2
                [/unit]

                {BLACK_LIGHTNING}
                [kill]
                    id=Wesir
                [/kill]

                [message]
                    speaker=Cornelya
                    message= _ "And so he's fled, predictably, and left us a parting gift. He thinks an undead dragon will give us pause? We have destroyed a greater one already. Elves, follow me to victory!"
                [/message]

                [objectives]
                    side=1
                    [objective]
                        description= _ "Destroy the Skeletal Dragon"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Tenma"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Kenshiro"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Cornelya"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Aeldhoryan"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Natsu"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Dragana"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Ikki"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Gelendras"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Garlin Ohn"
                        condition=lose
                    [/objective]

                    {TURNS_RUN_OUT}

                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/then]
            [else]
                [message]
                    speaker=Cornelya
                    message= _ "I have... lost...?"
                [/message]
                [message]
                    speaker=Kenshiro
                    message= _ "CORNELYA, NO!!!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=die
        [filter]
            id=Skeledragon
        [/filter]

        [kill]
            side=2
            animate=yes
        [/kill]

        [message]
            speaker=Dragana
            message= _ "At last, we stand victorious!"
        [/message]
        [message]
            speaker=Gelendras
            message= _ "Yes, but this was not a final victory. The necromancer has escaped, and half of the Lins-Elens has been destroyed. Still, now that we have a Queen-in-the-Woods by our side, we shall be unchallenged in our forest!"
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Like I said, I'm not sure I deserve a crown. But whatever power I have, I will put it to defend our people and nurture our forests. Right now, the soils of Metheldur must be purified..."
        [/message]
        [message]
            speaker=narrator
            message= _ "With those words, Cornelya closed her eyes; soon her whole body began to shine like a star, filling the forest with a warm white light. Then, a myriad streams of pearl-white arcane energy sprouted from the ground: faerie fire, the same one wielded by elven sylphs, but on the scale of a conflagration. The white flames ran the whole forest, seeping into every dead body that lay on the bloodied grass, purging them of dark magic. They vanished along with the light – but their effect remained, as the corpses of elves, horses and trees were suddenly blanketed in blossoming, vibrant flowers."
        [/message]
        [message]
            speaker=Gelendras
            message= _ "*This is far beyond anything father could do... So this is be what he meant by 'being a true King-in-the-Woods'... Tenma Yozora, you have no idea of how much we all owe you...*"
        [/message]

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Tenma
        [/filter]
        [message]
            speaker=Tenma
            message= _ "How could I have fallen now...?"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Aeldhoryan
        [/filter]
        [message]
            speaker=Aeldhoryan
            message= _ "I have failed... my people..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "FATHER, NO!!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Natsu
        [/filter]
        [message]
            speaker=Natsu
            message= _ "Ugh...! My... son..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "FATHER, NO!!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Kenshiro
        [/filter]
        [message]
            speaker=Kenshiro
            message= _ "How could I die... Cornelya..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "KENSHIRO, NO!!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Gelendras
        [/filter]
        [message]
            speaker=Gelendras
            message= _ "I fall... Please, do not allow the enemy to destroy Metheldur..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Brother, no!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Dragana
        [/filter]
        [message]
            speaker=Dragana
            message= _ "Argh...! I shouldn't have died..."
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Ikki
        [/filter]
        [message]
            speaker=Ikki
            message= _ "Argh! Curses on these Wesnothians...!"
        [/message]
        [message]
            speaker=Natsu
            message= _ "Ikki was an important leader amongst our people, without him we'll have a hard time fighting the Wesnothians!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Kaldan
        [/filter]
        [message]
            speaker=Kaldan
            message= _ "I die...?! Perhaps I was... too arrogant this time..."
        [/message]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Garlin
        [/filter]
        [if]
            [have_unit]
                id=Tenma
            [/have_unit]
            [then]
                [message]
                    speaker=Tenma
                    message= _ "No! I promised to protect Veshtar Joohn's drakes! Now, her army will be considerably weakened!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Gelendras
                    message= _ "No! Without the aid of the drakes, we will be far too outnumbered by these undead hordes!"
                [/message]
            [/else]
        [/if]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over

        [message]
            speaker=Tenma
            message= _ "We should have been quicker, we still have far greater enemies to fight!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
