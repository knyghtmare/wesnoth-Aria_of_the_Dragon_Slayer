#textdomain wesnoth-Aria_of_the_Dragon_Slayer

[scenario]
    id=44_Prelude_Of_The_Final_War
    name= _ "Prelude of the Final War"
    next_scenario=45_Return_Of_The_King
    map_data="{~add-ons/Aria_of_the_Dragon_Slayer/maps/44_Prelude_Of_The_Final_War.map}"
    {TURNS 55 51 47}
    {TWO_SUNS_DEFAULT_SCHEDULE}

    {SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC battlecry.ogg}
    {EXTRA_SCENARIO_MUSIC the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC nunc_dimittis.ogg}
    {EXTRA_SCENARIO_MUSIC loyalists.ogg}

    {WEAPON_SPECIALS_EVENTS}

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                description= _ "Defeat Galdra"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Olokun"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Valerya"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Derceto"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Algil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Veshtar Joohn"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Aeldhoryan"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Udhark"
                condition=lose
            [/objective]

            {AI_CONTROLLER_NOTE}
            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    {STARTING_VILLAGES 1 7}
    {STARTING_VILLAGES 2 12}

    [side]
        {TENMA}
        recruit=
        {GOLD 300 270 240}
        {INCOME 12 9 6}
        team_name=teamtenma
        user_team_name=_"Travellers"

        {FLAG_VARIANT6 ragged}
    [/side]

    {AI_CONTROLLER () 1 3,5,6 ()}

    [side]
        {GALDRA_AVATAR}
        recruit=Eternal Night Aria,Death Spectre Aria,Raging One Aria,Calamity Aria,Inquisitor Aria,Cloud of Gloom Aria,Soul Snatcher Aria,Jinx Beast Aria,Angry One Aria
        side=2
        team_name=galdra
        user_team_name=_"Nightmare Army"
        {GOLD 1300 1400 1500}
        {INCOME 30 40 50}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,archer,archer
            aggression=0.85
            caution=0.15
        [/ai]

        {FLAG_VARIANT6 ragged}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Eternal Night Aria) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Death Spectre Aria) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Raging One Aria) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Inquisitor Aria) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Calamity Aria) 2}

    [side]
        type=Arch Mage
        id=Gweniver
        gender=female
        name=_"Master Gweniver"
        canrecruit=yes
        recruit=Royal Guard,Paladin,Silver Mage,Swordsman,Knight,Red Mage,White Mage
        side=3
        team_name=teamtenma
        user_team_name=_"Empire of Wesnoth"
        {GOLD 500 460 420}
        {INCOME 20 15 10}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,mixed fighter,mixed fighter,healer,scout,scout
            aggression=0.65
            caution=0.35
        [/ai]
        {FLAG_VARIANT loyalist}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Royal Guard) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Paladin)21}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Silver Mage) 1}

    [side]
        no_leader=yes
        recruit=Revenant,Bone Shooter,Necrophage,Wraith,Lich
        side=4
        team_name=undead
        user_team_name=_"Umbra Army"
        gold=0
        income=0
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,mixed fighter,archer,scout
            aggression=0.85
            caution=0.15
        [/ai]
        {FLAG_VARIANT undead}
    [/side]

    [side]
        no_leader=yes
        recruit=Drake Blademaster,Inferno Drake,Drake Enforcer,Drake Warden,Hurricane Drake,Saurian Flanker,Drake Warrior,Fire Drake,Drake Flare,Drake Thrasher,Sky Drake,Saurian Ambusher
        side=5
        team_name=teamtenma
        user_team_name=_"Shakaar Drakes"
        {GOLD 650 600 550}
        {INCOME 25 20 15}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,archer,archer,scout,scout
        [/ai]
        {FLAG_VARIANT loyalist}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Drake Blademaster) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Drake Enforcer) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Drake Warden) 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Inferno Drake) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Hurricane Drake) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Saurian Flanker) 2}

    [side]
        no_leader=yes
        recruit=
        side=6
        team_name=teamtenma
        user_team_name=_"Knalgan Union"
        {GOLD 550 500 450}
        {INCOME 25 20 15}
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,mixed fighter,mixed fighter,scout
        [/ai]
        {FLAG_VARIANT knalgan}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Great Troll) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Troll Warrior) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Troll Boulderlobber) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Dwarvish Lord) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Dwarvish Dragonguard) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Dwarvish Explorer) 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Dwarvish Sentinel) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 (Dwarvish Runemaster) 3}

    [side]
        no_leader=yes
        recruit=Wersefet,Medjay,Maryannu,Forest Mage,Thunder Mage,Crimson Mage,Cleric
        side=7
        team_name=teamtenma
        user_team_name=_"New Maat'Kare"
        gold=0
        income=0
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,mixed fighter,mixed fighter,archer,archer,healer
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT long}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 (Forest Mage) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 (Thunder Mage) 2}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 (Crimson Mage) 2}

    [side]
        no_leader=yes
        recruit=
        side=8
        team_name=teamtenma
        user_team_name=_"Red Moon Clan"
        gold=0
        income=0
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,mixed fighter,archer,archer,scout
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT undead}
    [/side]

    [side]
        no_leader=yes
        recruit=Lava Giant,Mistral,Stone Titan,Fire Guardian,Furnace Beast,Zephyr,Fire Wisp,Stone Golem
        side=9
        team_name=teamtenma
        user_team_name=_"New Maat'Kare"
        gold=0
        income=0
        [ai]
            passive_leader=yes
            recruitment_pattern=fighter,fighter,fighter,archer,archer,scout
            aggression=0.75
            caution=0.25
        [/ai]

        {FLAG_VARIANT long}
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 (Lava Giant) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 (Fire Guardian) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 (Stone Titan) 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 9 (Mistral) 3}

    [event]
        name=prestart

        [unstore_unit]
            variable=olokun5_store
            x,y=32,30
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE olokun5_store}

        [unstore_unit]
            variable=derceto5_store
            x,y=28,31
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE derceto5_store}

        [unstore_unit]
            variable=valerya6_store
            x,y=16,5
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE valerya6_store}

        [unstore_unit]
            variable=algil_king_store
            x,y=15,5
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE algil_king_store}

        [unstore_unit]
            variable=aeldhoryan3_store
            x,y=15,6
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE aeldhoryan3_store}

        [unstore_unit]
            variable=donar5_store
            x,y=15,4
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE donar5_store}

        [unstore_unit]
            variable=udhark_king_store
            x,y=16,4
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE udhark_king_store}

        [unstore_unit]
            variable=tallin_store
            x,y=16,3
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE tallin_store}

        [unstore_unit]
            variable=veshtar_store
            x,y=36,35
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE veshtar_store}

        {MODIFY_UNIT id=Veshtar side 5}
        {MODIFY_UNIT id=Udhark side 6}
        {MODIFY_UNIT id=Algil side 6}
        {MODIFY_UNIT id=Tallin side 1}
        {MODIFY_UNIT id=Donar side 1}

        [foreach]
            array=tenma_main_group_new
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [foreach]
            array=tenma_main_group_second
            [do]
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    x=recall
                    y=recall
                [/unstore_unit]
            [/do]
        [/foreach]

        [foreach]
            array=udhark_army
            [do]
                {VARIABLE this_item.side 6}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE udhark_army}

        [foreach]
            array=algil_army
            [do]
                {VARIABLE this_item.side 6}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE algil_army}

        [foreach]
            array=donars_veterans_second
            [do]
                {VARIABLE this_item.side 6}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE donars_veterans_second}

        [foreach]
            array=drake_army
            [do]
                {VARIABLE this_item.side 5}
                [unstore_unit]
                    variable=this_item
                    x,y=recall,recall
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE drake_army}

        [clear_variable]
            name=tenma_main_group,tenma_main_group_second
        [/clear_variable]

        {NAMED_LOYAL_UNIT 3 (Halberdier) 29 27 (Tayn) ("Tayn")} {GUARDIAN}
        {LOYAL_UNIT 3 (Halberdier) 35 27} {GUARDIAN}
        {NAMED_LOYAL_UNIT 5 (Inferno Drake) 14 4 (Garlin) ("Garlin Ohn")} {GUARDIAN}

        [store_unit]
            kill=yes
            variable=true_elementals_three
            [filter]
                side=1
                type=Air Spirit,Fire Spirit,Water Spirit, Earth Spirit, Air Embodiment,Fire Embodiment,Water Embodiment,Earth Embodiment,Gali,Niti,Agni,Bhumi
            [/filter]
        [/store_unit]

        [store_unit]
            [filter]
                id=Tenma
            [/filter]
            variable=tenma_temp_store
            kill=yes
        [/store_unit]

        {MODIFY_UNIT id=Donar canrecruit no}
        {MODIFY_UNIT id=Tallin canrecruit no}

        [unit_overlay]
            id=Tallin
            image=misc/hero-icon.png
        [/unit_overlay]

        [set_variable]
            name=threaten_galdra
            value=0
        [/set_variable]
        [set_variable]
            name=wesir_arrived
            value=0
        [/set_variable]
    [/event]

    [event]
        name=start

        {CAPTURE_VILLAGES 3 13 46 9}
        {CAPTURE_VILLAGES 3 46 6 10}
        {CAPTURE_VILLAGES 3 21 4 7}

        [kill]
            id=Yiwen
        [/kill]

        [hide_unit]
            id=Galdra
        [/hide_unit]

        [message]
            speaker=Gweniver
            message= _ "That was a difficult battle, but we've managed to prevail... I cannot express my gratitude with words only, strangers. We've been completely cut off from Weldyn for weeks; without your aid, Dan'Tonk would be a pile of rubble by now."
        [/message]
        [message]
            speaker=Olokun
            message= _ "We're simply helping you face a common foe, and one that may wreak havoc all over the world unless we stop her."
        [/message]
        [message]
            speaker=Gweniver
            message= _ "Still, to think that we would ever be aided by drakes... I must apologize for having ever believed you to be an aggressive, selfish nation!"
        [/message]
        [message]
            speaker=Veshtar
            message= _ "But you were not wrong, human. It is just as my friend Olokun said: right now we have an enemy far worse than your petty country could ever be, and so we must unite, as unpleasant as it is..."
        [/message]
        [message]
            speaker=Tayn
            message= _ "Enemies coming from the north!"
        [/message]
        [message]
            speaker=Derceto
            message= _ "(staring into the distance) Worry not, they are the Northern Alliance... (smirking) And they have some of our friends with them."
        [/message]

        {MOVE_UNIT id=Valerya 33 31}
        {MOVE_UNIT id=Aeldhoryan 32 25}
        {MOVE_UNIT id=Algil 30 30}
        {MOVE_UNIT id=Udhark 31 31}
        {MOVE_UNIT id=Tallin 28 30}
        {MOVE_UNIT id=Donar 29 30}
        {MOVE_UNIT id=Garlin 36 30}

        [message]
            speaker=Valerya
            message= _ "And so you were here all the time... Damn you, didn't you say you would be waiting for us at the Fields of War?! We were lucky that one of our gryphon scouts recognized your elementals near the Ford of Abez!"
        [/message]
        [message]
            speaker=Derceto
            message= _ "(stung) Well, apologies for stumbling on a swarm of nightmares at the mouth of the Great River, worrying about you and deciding to help the Wesnothians to prevent Galdra's forces from reaching the Northlands! And besides, it's not like a change of plans wasn't expected!"
        [/message]
        [message]
            speaker=Olokun
            message= _ "Ladies, please, calm down. We should be glad that we're all safe – and I must say I'm very glad to see that you've managed to fulfil your mission, Algil; not only that, but you've harnessed the power of the other Hammer! That means we now have four Kings of Irdya on our side..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "Five, actually; Cornelya has obtained the Relic of the elves by accessing her faerie side, or so Tenma said."
        [/message]
        [message]
            speaker=Olokun
            message= _ "And where is she? I could barely believe that she was safe and sound when Veshtar Joohn told me; didn't she join you in the Heart Mountains?"
        [/message]
        [message]
            speaker=Valerya
            message= _ "Olokun, we... we've got bad news. You do remember our theory that Galdra would use the Sky Soul in case of defeat, right? We were wrong..."
        [/message]
        [message]
            speaker=Algil
            message= _ "See, we had just defeated our enemies when the monster of your people's legends appeared from the sky... We stood no chance against him, so that girl, well..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "(appalled) No... You can't be... <i>Svarballi has awoken again</i>?!"
        [/message]
        [message]
            speaker=Veshtar
            message= _ "And you left Tenma Yozora to fight him by herself?! You fools, how could you do that?! Don't you know how powerful he is?!"
        [/message]
        [message]
            speaker=Derceto
            message= _ "But that is exactly why they were right in leaving the battlefield; Tenma spent all this time preparing to destroy him, as for us, there is nothing we can do... But when did that happen? Their battle should be over by now!"
        [/message]
        [message]
            speaker=Valerya
            message= _ "That's what's worrying us; we've got no sign of Tenma after we left her at the Dwarven Doors, but we've got no sign of Svarballi either..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "Lady Gweniver, I apologize for having to leave now, but we have a dear friend who needs our aid..."
        [/message]
        [message]
            speaker=Derceto
            message= _ "But, Olokun..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "I know, I know we won't be of much aid, but I simply can't sit idly here knowing that she's fighting that monster alone!"
        [/message]

        {MAGIC_STORM}

        [unhide_unit]
            id=Galdra
        [/unhide_unit]

        [message]
            speaker=Galdra
            message= _ "Worry not about Tenma, children; I can tell you that she is alive – though how long she will last is beyond even my foresight..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "About time you showed your face on the battlefield, 'Avatar of Magic'."
        [/message]
        [message]
            speaker=Galdra
            message= _ "(chuckling) Were you so eager for me to enter the scene? Interesting, I did not know you were in such a hurry to die..."
        [/message]
        [message]
            speaker=Gweniver
            message= _ "Prince Aeldhoryan, we're so relieved to see with our own eyes that the rumours were not true...! Please, lead us to victory!"
        [/message]
        [message]
            speaker=Aeldhoryan
            message= _ "Protecting you is nothing but my duty, my people. Now, follow me! Let the Banner of the West-North fly in triumph once more!"
        [/message]

        {MODIFY_UNIT id=Aeldhoryan side 3}

        {MOVE_UNIT id=Algil 28 19}
        {MOVE_UNIT id=Udhark 36 19}
        {MOVE_UNIT id=Tallin 39 20}
        {MOVE_UNIT id=Donar 25 20}
        {MOVE_UNIT id=Garlin 35 36}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1,3,5,6
            [filter_location]
                x=39
                y=56
                radius=8
            [/filter_location]
        [/filter]

        [message]
            speaker=Udhark
            message= _ "Do not lose heart now, warriors, we're close to meeting the monster face to face!"
        [/message]
        [message]
            speaker=Galdra
            message= _ "Pathetic little children, you still have not the slightest idea of who you are dealing with..."
        [/message]

        {GENERIC_UNIT 2 (Calamity) 37 57}
        {GENERIC_UNIT 2 (Calamity) 39 58}
        {GENERIC_UNIT 2 (Calamity) 41 58}
        {GENERIC_UNIT 2 (Eternal Night) 42 55}
        {GENERIC_UNIT 2 (Eternal Night) 40 53}

        [modify_side]
            side=2
            {GOLD 1300 1400 1500}
        [/modify_side]

        [message]
            speaker=Aeldhoryan
            message= _ "Curses...! Retreat, everyone! We must not face this new wave on open field!"
        [/message]

        [set_variable]
            name=threaten_galdra
            value=1
        [/set_variable]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=threaten_galdra
                numerical_equals=1
            [/variable]
            [then]
                [set_variable]
                    name=threaten_galdra
                    value=0
                [/set_variable]

                [set_variable]
                    name=wesir_arrived
                    value=1
                [/set_variable]

                [unit]
                    {WESIR_UNDEAD}
                    x,y=30,3
                    side=4
                [/unit]

                {LOYAL_UNIT 4 (Death Knight) 29 2} {GUARDIAN}
                {LOYAL_UNIT 4 (Death Knight) 28 3} {GUARDIAN}
                {LOYAL_UNIT 4 (Death Knight) 29 5} {GUARDIAN}
                {LOYAL_UNIT 4 (Death Knight) 31 5} {GUARDIAN}
                {LOYAL_UNIT 4 (Death Knight) 32 3} {GUARDIAN}
                {LOYAL_UNIT 4 (Death Knight) 31 2} {GUARDIAN}

                [terrain]
                    x=28,28,29,30,31,32,32
                    y=2,4,3-4,1-5,3-4,2,4
                    terrain=Ce
                [/terrain]
                [terrain]
                    x=30
                    y=3
                    terrain=Ke
                [/terrain]

                [modify_side]
                    side=4
                    {GOLD 1200 1300 1400}
                [/modify_side]

                [message]
                    speaker=Valerya
                    message= _ "Oh, damn, don't tell me that's Wesir again!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "Did you think that my little defeat in the forest of the elves would sway me from my determination to destroy you all? Even if it takes me decades, I shall not fail to have my revenge!"
                [/message]
                [message]
                    speaker=Olokun
                    message= _ "Wesir, even if you hate Master Ankhmare, you were a master of New Maat'Kare yourself once! Instead of fighting each other, we should be joining forces to defeat Galdra, or else the entire world will be at her mercy!"
                [/message]
                [message]
                    speaker=Wesir
                    message= _ "I do not need join forces with treacherous little pests like you, your master and your partners! I need not join forces with a weakened faction to destroy another weakened faction, I shall crush you both at once!"
                [/message]

                [objectives]
                    side=1
                    [objective]
                        description= _ "Defeat Galdra"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Defeat Wesir"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Olokun"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Valerya"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Derceto"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Algil"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Veshtar Joohn"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Aeldhoryan"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Udhark"
                        condition=lose
                    [/objective]

                    {TURNS_RUN_OUT}

                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]

                {VARIABLE reinforcements_time 0}
            [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=wesir_arrived
                numerical_equals=1
            [/variable]
            [then]
                {VARIABLE_INC reinforcements_time}
            [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [if]
            {VARIABLE_NUM_GREATER_OR_EQUAL_THAN reinforcements_time 5}
            [variable]
                name=wesir_arrived
                numerical_equals=1
            [/variable]
            [then]
                [set_variable]
                    name=wesir_arrived
                    value=0
                [/set_variable]

                [message]
                    speaker=Algil
                    message= _ "By all Nine Hells, we're surrounded by swarms of abominations from all sides...!"
                [/message]
                [message]
                    speaker=Aeldhoryan
                    message= _ "We have no choice but to fight on! If we want to protect our world and our people, we have no choice but to win this battle!"
                [/message]

                [sound]
                    name=horn-signals/horn-2.ogg
                [/sound]
                [delay]
                    time=1000
                [/delay]

                [message]
                    speaker=Tallin
                    message= _ "No, not another enemy...!"
                [/message]
                [message]
                    speaker=Olokun
                    message= _ "(surprised) Wait... Those banners, they're...!"
                [/message]

                [unit]
                    {ANKHMARE}
                    x,y=1,40
                    side=7
                [/unit]

                {MOVE_UNIT id=Ankhmare 12 33}

                [unstore_unit]
                    variable=bogor2_store
                    x,y=1,24
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE bogor2_store}

                [remove_unit_overlay]
                    id=Bogor
                    image=misc/hero-icon.png
                [/remove_unit_overlay]

                {MODIFY_UNIT id=Bogor side 8}
                {MODIFY_UNIT id=Bogor canrecruit yes}
                {MOVE_UNIT id=Bogor 11 26}

                [set_extra_recruit]
                    extra_recruit=Orcish Warlord,Orcish Slurbow,Orcish Sorcerer,Direwolf Rider,Orcish Warrior,Orcish Crossbowman,Orcish Warlock
                    id=Bogor
                [/set_extra_recruit]

                [unit]
                    id=Oluwinde
                    name=_ "Captain Oluwinde"
                    canrecruit=yes
                    unrenamable=yes
                    side=7
                    x,y=1,41
                    extra_recruit=Chomi Ranger,Chomi Hero,Chomi Spear Thrower,Chomi Holy Father,Chomi Light Infantry,Chomi Javelineer,Chomi Soldier,Chomi Priest
                    type=Chomi Hero
                    [modifications]
                        {TRAIT_STRONG}
                        {TRAIT_RESILIENT}
                        {TRAIT_LOYAL}
                    [/modifications]
                [/unit]

                {MOVE_UNIT id=Oluwinde 9 39}

                [unit]
                    id=Shamut
                    name=_ "Commander Shamut"
                    canrecruit=yes
                    unrenamable=yes
                    side=7
                    x,y=1,42
                    extra_recruit=Washraha Jackal Warrior,Washraja,Deshra Juggernaut,Deshra Flattener,Washraha Champion,Washraha Seeker,Deshra Warrior, Deshra Clubber
                    type=Washraha Lightning Striker
                    [modifications]
                        {TRAIT_STRONG}
                        {TRAIT_DEXTROUS}
                        {TRAIT_LOYAL}
                    [/modifications]
                [/unit]

                {MOVE_UNIT id=Shamut 19 35}

                [modify_side]
                    side=7
                    {GOLD 900 850 800}
                [/modify_side]
                [modify_side]
                    side=8
                    {GOLD 700 650 600}
                [/modify_side]

                [unit]
                    type=Mage of Storms
                    id=Pawero
                    name=_"Pawero"
                    canrecruit=yes
                    side=9
                    x=9
                    y=32
                [/unit]
                {EXTRA_CRIMSON_THREE}
                {EXTRA_LUCENT_THREE}

                [unit]
                    type=Prophetess of Light
                    id=Sebek
                    name=_"Sebek"
                    canrecruit=yes
                    side=9
                    x=9
                    y=35
                [/unit]
                {EXTRA_CRIMSON_THREE}

                [unit]
                    type=Crimson Master
                    id=Kemanut
                    name=_"Kemanut"
                    gender=female
                    canrecruit=yes
                    side=9
                    x=15
                    y=32
                [/unit]
                {EXTRA_LUCENT_THREE}
                {EXTRA_UMBRA_THREE}

                [unit]
                    type=Necromancer
                    id=Iumeri
                    name=_"Iumeri"
                    canrecruit=yes
                    side=9
                    x=15
                    y=35
                [/unit]
                {EXTRA_AQUAMARINE_THREE}

                [modify_side]
                    side=9
                    {GOLD 600 550 500}
                [/modify_side]

                {REPLACE_SCENARIO_MUSIC legends_of_the_north.ogg}
                {APPEND_MUSIC siege_of_laurelmor.ogg}
                {APPEND_MUSIC battlecry.ogg}
                {APPEND_MUSIC the_city_falls.ogg}
                {APPEND_MUSIC casualties_of_war.ogg}

                [terrain]
                    x=10,11,12,13,13,8,9,10,18,19,20
                    y=25-26,25-28,25-26,25,27,38-39,38-40,38-39,34-35,34-36,34-35
                    terrain=Ce
                [/terrain]
                [terrain]
                    x=11,12,19,9
                    y=26,33,35,39
                    terrain=Ke
                [/terrain]

                [terrain]
                    x=9,9,15,15
                    y=35,32,32,35
                    terrain=Ke
                [/terrain]
                [terrain]
                    x=9,15,10,10,11,11,12,12,13,13,14,14
                    y=33-34,33-34,31,35,31,36,30,36,31,36,31,35
                    terrain=Ce
                [/terrain]

                [scroll_to_unit]
                    id=Ankhmare
                [/scroll_to_unit]
                [delay]
                    time=600
                [/delay]
                [scroll_to_unit]
                    id=Bogor
                [/scroll_to_unit]
                [delay]
                    time=600
                [/delay]
                [scroll_to_unit]
                    id=Shamut
                [/scroll_to_unit]
                [delay]
                    time=600
                [/delay]

                [message]
                    speaker=Valerya
                    message= _ "(smiling) Blessed be the heavens, they're our friends from beyond the ocean! But why are they here...?"
                [/message]
                [message]
                    speaker=Ankhmare
                    message= _ "A few weeks ago, we received a messenger from the fauns and the faeries in Argea, warning us that a great storm was coming, and that our friends from the Great Continent needed our aid more than ever. On the way here, we stopped at Ifeh, and Father Yroko reinforced our army with his own soldiers. We were also joined by this Washrahani warrior, Shamut, who was more than willing to help us when she learned we were going to Wesnoth..."
                [/message]
                [message]
                    speaker=Shamut
                    message= _ "(says something in her own language)"
                [/message]
                [message]
                    speaker=Ankhmare
                    message= _ "She says that her sister was a commander fighting for Wesnothians, and that they let her die, and so she wants to avenge her."
                [/message]
                [message]
                    speaker=Olokun
                    message= _ "Well, any aid is welcome, I suppose? And you, Chief Bogor, have you come because you begun to consider us your friends?"
                [/message]
                [message]
                    speaker=Bogor
                    message= _ "(smirking) Pfff, I just came here because that elf girl said there would be an epic battle on this continent, and so I couldn't miss it, not when even the tree-huggers would fight! By the way, where is she? I want to compete with her for the higher number of kills!"
                [/message]

                [unstore_unit]
                    variable=cornelya_queen_store
                    x,y=61,28
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE cornelya_queen_store}

                {MOVE_UNIT id=Cornelya 57 29}

                [unstore_unit]
                    variable=kenshiro_store3
                    x,y=61,26
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE kenshiro_store3}

                {MOVE_UNIT id=Kenshiro 57 28}

                [unstore_unit]
                    variable=ikki_store2
                    x,y=61,26
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE ikki_store2}

                {MOVE_UNIT id=Ikki 56 27}

                [unstore_unit]
                    variable=natsu_store2
                    x,y=61,26
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE natsu_store2}

                {MOVE_UNIT id=Natsu 58 28}

                [unstore_unit]
                    variable=umbrius2_store
                    x,y=61,28
                    find_vacant=yes
                [/unstore_unit]
                {CLEAR_VARIABLE umbrius2_store}

                {MOVE_UNIT id=Umbrius 57 32}

                [unit]
                    {GELENDRAS}
                    x,y=61,24
                    side=1
                [/unit]

                {MODIFY_UNIT id=Gelendras canrecruit no}

                [unit_overlay]
                    id=Gelendras
                    image=misc/hero-icon.png
                [/unit_overlay]

                {MOVE_UNIT id=Gelendras 57 30}

                [unit]
                    {DRAGANA}
                    x,y=61,25
                    canrecruit=yes
                    side=1
                [/unit]

                {MOVE_UNIT id=Dragana 58 29}

                [set_extra_recruit]
                    extra_recruit=Baryag Rider,Baryag Tracker,Baryag Raging Bear,Baryag Spy,Baryag Warlord,Baryag Ranger,Baryag Warfather,Volva,Norn
                    id=Dragana
                [/set_extra_recruit]

                [set_extra_recruit]
                    extra_recruit=Faun Soldier,Anuran Rider,Faerie Sprite,Fire Faerie,Elvish Champion,Elvish Enchantress,Elvish Sharpshooter,Elvish Shyde,Ancient Wose,Elvish Hero,Elvish Marksman,Elvish Sorceress,Elvish Druid,Elder Wose
                    id=Cornelya
                [/set_extra_recruit]

                [unit]
                    type=Faerie Spirit
                    id=Idunn
                    name=_"Lady Idunn"
                    profile="portraits/idunn.png"
                    side=1
                    x,y=61,25
                    {IS_HERO}
                    [modifications]
                        {TRAIT_INTELLIGENT}
                        {TRAIT_AGED}
                    [/modifications]
                [/unit]

                {MOVE_UNIT id=Idunn 58 31}

                [foreach]
                    array=cornelya_army_woodlander
                    [do]
                        [unstore_unit]
                            variable=this_item
                            find_vacant=yes
                            x=recall
                            y=recall
                        [/unstore_unit]
                    [/do]
                [/foreach]

                [foreach]
                    array=cornelya_faerie_army
                    [do]
                        [unstore_unit]
                            variable=this_item
                            find_vacant=yes
                            x=recall
                            y=recall
                        [/unstore_unit]
                    [/do]
                [/foreach]

                [foreach]
                    array=cornelya_elf_army
                    [do]
                        [unstore_unit]
                            variable=this_item
                            find_vacant=yes
                            x=recall
                            y=recall
                        [/unstore_unit]
                    [/do]
                [/foreach]

                [foreach]
                    array=cornelya_blackelf_army
                    [do]
                        [unstore_unit]
                            variable=this_item
                            find_vacant=yes
                            x=recall
                            y=recall
                        [/unstore_unit]
                    [/do]
                [/foreach]

                [foreach]
                    array=sogen_army_second
                    [do]
                        [unstore_unit]
                            variable=this_item
                            find_vacant=yes
                            x=recall
                            y=recall
                        [/unstore_unit]
                    [/do]
                [/foreach]

                [clear_variable]
                    name=sogen_army_second,cornelya_army_second
                [/clear_variable]

                [terrain]
                    x=55,55,56,57,58,59,59
                    y=28,30,28-29,27-31,28-29,28,30
                    terrain=Ce
                [/terrain]
                [terrain]
                    x,y=57,29
                    terrain=Ke
                [/terrain]

                [gold]
                    side=1
                    amount=500
                [/gold]

                [message]
                    speaker=Cornelya
                    message= _ "If you want a rematch for Argea, then here I am, Bogor. I'm glad that you have come as well."
                [/message]
                [message]
                    speaker=Algil
                    message= _ "Och, how did she...?"
                [/message]
                [message]
                    speaker=Umbrius
                    message= _ "As the Queen-in-the-Woods, she's able to open the Sidhe, or the pathway connecting the mundane and the faerie worlds, which can be accessed through any Great Tree. Thus we were able to move from the Heartwood Valley to the Lins-Elens, and then here, in no time."
                [/message]
                [message]
                    speaker=Idunn
                    message= _ "It's impressive that she's managed to let even humans cross it. Never had I heard of anyone other than the Children of the Forests being able to walk it unscathed."
                [/message]
                [message]
                    speaker=Dragana
                    message= _ "Not really unscathed, though; I've never felt so nauseated in my life..."
                [/message]
                [if]
                    [have_unit]
                        id=Galdra
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Galdra
                            message= _ "And so another Irdyan Queen has appeared... (snickering) Now things will finally get interesting..."
                        [/message]
                        [message]
                            speaker=Derceto
                            message= _ "Indeed they will, Avatar of Magic, for now we have more friends on our side. Everyone, CHARGE!"
                        [/message]
                    [/then]
                [/if]
                [if]
                    [have_unit]
                        id=Wesir
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Ankhmare
                            message= _ "And you, Wesir... I once respected you as a colleague and a fellow Maat'Karian, but no longer. If causing even more death and destruction at this crucial moment is what you've chosen to do, then I shall end you myself!"
                        [/message]
                        [message]
                            speaker=Wesir
                            message= _ "And so we shall settle this score once and for all, Ankhmare..."
                        [/message]
                    [/then]
                [/if]

                [modify_side]
                    side=4
                    {GOLD 1000 1100 1200}
                [/modify_side]

                [objectives]
                    side=1
                    [objective]
                        description= _ "Defeat Galdra"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Defeat Wesir"
                        condition=win
                    [/objective]
                    [objective]
                        description= _ "Death of Olokun"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Kenshiro"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Valerya"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of any of the Kings and Queens"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Aeldhoryan"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Natsu"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Dragana Vasilya"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Donar"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Gelendras"
                        condition=lose
                    [/objective]
                    [objective]
                        description= _ "Death of Idunn"
                        condition=lose
                    [/objective]

                    {TURNS_RUN_OUT}

                    [gold_carryover]
                        bonus=yes
                        carryover_percentage=40
                    [/gold_carryover]
                [/objectives]
            [/then]
        [/if]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Wesir
        [/filter]

        [message]
            speaker=Wesir
            message= _ "Arrrgh!!! I... must... retreat...!"
        [/message]
        [message]
            speaker=Ankhmare
            message= _ "Beware, he can teleport!"
        [/message]

        {BLACK_LIGHTNING}

        [kill]
            id=Wesir
        [/kill]

        [message]
            speaker=Kenshiro
            message= _ "Curses, he escaped again..."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "Judging by the damage he just took, though, he won't be able to go far this time."
        [/message]
    [/event]

    [event]
        name=attack
        [filter]
            side=1,3,5,6,7,8,9
            level=3
            [or]
                level=4
            [/or]
            [or]
                level=5
            [/or]
            [or]
                level=6
            [/or]
        [/filter]
        [filter_second]
            id=Galdra
        [/filter_second]

        [message]
            speaker=Galdra
            message= _ "I am impressed that you managed to lay a hand on me, child – so much, in fact, that I will give you another chance; I want to see how far you can go..."
        [/message]

        {MAGIC_STORM}

        [kill]
            id=Galdra
        [/kill]

        [message]
            speaker=unit
            message= _ "Wait, was that it...? Has Galdra been defeated?"
        [/message]
        [message]
            speaker=Derceto
            message= _ "Definitely not; in fact, I fear we haven't even seen her full power yet..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "Still, for some reason she's decided to give us a truce..."
        [/message]
    [/event]

    [event]
        name=enemies defeated

        {REPEAT 3 ({QUAKE "rumble.ogg"})}

        [message]
            speaker=Aeldhoryan
            message= _ "Curses, is this another trickery of that girl?!"
        [/message]
        [message]
            speaker=Ankhmare
            message= _ "(alarmed) No... I think... it's something far worse..."
        [/message]
        [message]
            speaker=Kenshiro
            message= _ "Then what was that? Was it caused by the battle between Tenma and the Sky Dragon?"
        [/message]
        [message]
            speaker=Valerya
            message= _ "That we can't say for sure; what we can say is that there was a massive, I'd say cataclysmic, disturbance in the currents of magic of this world..."
        [/message]
        [message]
            speaker=Ankhmare
            message= _ "And apparently it comes from the north, where..."
        [/message]
        [message]
            speaker=Olokun
            message= _ "...Where one of the currents' convergences lie – and probably where Tenma is..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "Speaking of which, I have a message to you from her. She said you should search for the tomb of Delfador the Great and find his staff; according to her, that's the Regalia of the humans."
        [/message]
        [message]
            speaker=Olokun
            message= _ "Then go and find it yourself; I'm going north and search for her. Besides, I'm certain it requires a great level of power and wisdom to be wielded..."
        [/message]
        [message]
            speaker=Valerya
            message= _ "Now you're being obtuse, Olokun. There was a reason she wanted you, of all people, to wield it. A Regalia must be wielded by a human who has the respect of all human nations; I may be respected by Northerners and Maat'Karians, Prince Aeldhoryan is respected by Wesnothians, and Tenma is respected by the Sogen and the New Maat'Karians; but you have fought alongside all these people, and they have all noticed how you've risked your own life for them, even though you were not one of them."
        [/message]
        [message]
            speaker=Natsu
            message= _ "The Sorceress is right. Tales of how he fought against Aetheryon along with Tenma are famous amongst us; if we were to choose a representative of the humans in this alliance, we'd choose him."
        [/message]
        [message]
            speaker=Dragana
            message= _ "I have witnessed, as did every Baryag, how bravely he fought against the drakes of Vladnir Ohn, even helping our now lost city of Mhreghost. Such a powerful, fearless and loyal fighter is the kind of person everyone amongst us strive to become; so, it is only fitting that a man like him has earned our respect and loyalty."
        [/message]
        [if]
            [have_unit]
                id=Tallin
            [/have_unit]
            [then]
                [message]
                    speaker=Tallin
                    message= _ "Olokun helped us fight Aelvar, even descending into the depths of Knalga to prevent him from destroying the Earth's Core. Although he was unable to succeed, we of the Northern Alliance were thankful that such a powerful mage had willingly joined us in our war. As the Alliance's human representative, I make the Sogen priestess' words my own."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Donar
                    message= _ "Olokun helped us fight Aelvar, even descending into the depths of Knalga to prevent him from destroying the Earth's Core. In spite of how that affair ended, we of the Northern Alliance are thankful that such a powerful mage joined us in our war. As the Alliance's last human authority, I make the Sogen priestess' words my own."
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Aeldhoryan
            message= _ "Gweniver has told me of how fiercely you fought to defend Dan'Tonk; even if you say that you only wanted to relieve the Northerners of more enemies, only someone who truly cared about these people would have risked so much for them. I, Crown Prince Aeldhoryan of Wesnoth, humbly accept you as our paramount leader."
        [/message]
        [message]
            speaker=Ankhmare
            message= _ "And what can Maat'Karians and Chomi say about you? We all have known you from childhood, and we all know the kind of person you have grown into. As if that wasn't enough, you went on a worldwide journey merely for the hope of finding the one who could relieve us of our ancient burden. I should no longer address you as my disciple, but as my fellow Master. You, Olokun, are definitely the most fitting to represent us all."
        [/message]
        [message]
            speaker=Olokun
            message= _ "Well... After such words, how could I even think of refusing? If this is everyone's will, then I, Olokun of Ifeh and New Maat'Kare, before all of you, vow to honour your trust in me to the fullest of my abilities; I will find the Regalia of humans and use it for the sake of all of you!"
        [/message]
        [message]
            speaker=narrator
            message= _ "<i>Thunderous approval</i>"
        [/message]
        [message]
            speaker=Aeldhoryan
            message= _ "I know where Delfador's tomb lies; and with my seal, we'll have safe-conduct through Wesnothian lands."
        [/message]
        [message]
            speaker=Dragana
            message= _ "Please, allow some of my warriors to escort you; your Wesnothians have been fighting fiercely for hours, but my Baryags are well rested and still full of energy."
        [/message]
        [message]
            speaker=Cornelya
            message= _ "I'll go north and see what has happened there; Bogor, you might benefit from following me, as the north is where the orcs of this continents live."
        [/message]
        [message]
            speaker=Bogor
            message= _ "Well thought; I really want to see whether our distant cousins deserve being called 'orcs'... Also, I need to find out if this blade will work like the shamans predicted it would..."
        [/message]
        [if]
            [have_unit]
                id=Tallin
            [/have_unit]
            [then]
                [message]
                    speaker=Derceto
                    message= _ "I've talked with Udhark, Algil and Tallinn IV, and we've agreed to stay here, tend to the wounded and protect Dan'Tonk against further aggression; it might be a good idea to send refugees from the countryside to this city, prince."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Derceto
                    message= _ "I've talked with Udhark, Algil and Donar, and we've agreed to stay here, tend to the wounded and protect Dan'Tonk against further aggression; it might be a good idea to send refugees from the countryside to this city, prince."
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Aeldhoryan
            message= _ "Indeed it will; thank you for helping my people, friends..."
        [/message]
        [message]
            speaker=Derceto
            message= _ "(hugging Olokun) And please, return as soon as you can, I'm only staying here not to slow you down, but I swear I'll flood all of Wesnoth to search for you if I have to!"
        [/message]
        [message]
            speaker=Olokun
            message= _ "(smiling) All right, all right, I promise I'll be back in a blink..."
        [/message]

        {MODIFY_UNIT id=Aeldhoryan side 1}
        {MODIFY_UNIT id=Bogor side 1}
        {MODIFY_UNIT id=Ankhmare side 1}
        {MODIFY_UNIT (side=5) side 1}
        {MODIFY_UNIT (side=6) side 1}

        [unstore_unit]
            variable=tenma_temp_store
            x=2
            y=2
            find_vacant=yes
        [/unstore_unit]
        {CLEAR_VARIABLE tenma_temp_store}

        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    {HEROES_LAST_BREATH_LAST}

    [event]
        name=time over

        [message]
            speaker=Olokun
            message= _ "How could we waste so much time here when Tenma is in need?!"
        [/message]

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
